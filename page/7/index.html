<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/ortrait.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/ortrait.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/ortrait.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.suvvm.work","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
<meta property="og:type" content="website">
<meta property="og:title" content="SUVVM">
<meta property="og:url" content="https://www.suvvm.work/page/7/index.html">
<meta property="og:site_name" content="SUVVM">
<meta property="og:description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="SUVVM">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.suvvm.work/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>SUVVM</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e5190116d64be66cac29daef18c94ac0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SUVVM</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">呜嗷SUVVM</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/12/16/Spring%E7%90%86%E8%AE%BA%E6%A2%B3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/16/Spring%E7%90%86%E8%AE%BA%E6%A2%B3%E7%90%86/" class="post-title-link" itemprop="url">Spring理论梳理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-16 18:48:29" itemprop="dateCreated datePublished" datetime="2019-12-16T18:48:29+08:00">2019-12-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%90%86%E8%AE%BA%E5%BD%92%E7%BA%B3/" itemprop="url" rel="index"><span itemprop="name">理论归纳</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><p>[TOC]</p>
<h2 id="Spring概述"><a href="#Spring概述" class="headerlink" title="Spring概述"></a>Spring概述</h2><h3 id="WEB架构层"><a href="#WEB架构层" class="headerlink" title="WEB架构层"></a>WEB架构层</h3><ul>
<li>关系数据库层</li>
<li>表示层</li>
<li>业务层</li>
</ul>
<h3 id="Spring使用简单POJO来克服的问题"><a href="#Spring使用简单POJO来克服的问题" class="headerlink" title="Spring使用简单POJO来克服的问题"></a>Spring使用简单POJO来克服的问题</h3><ul>
<li>Web应用程序可能包含实现其核心功能所不需要的大量代码</li>
<li>单元测试困难</li>
<li>j2ee设计模式由开发人员变更，其他应用不能使用这些设计模式</li>
<li>应用代码依赖于j2ee容器不能迁移至其他容器</li>
</ul>
<h3 id="Spring功能"><a href="#Spring功能" class="headerlink" title="Spring功能"></a>Spring功能</h3><ul>
<li>可插拔性</li>
<li>依赖注入(DI) DI松散耦合，无需自建与关联业务层对象，只需在Spring配置文件中描述如何创建与依赖，允许可插拔性易于维护重用</li>
<li>面向方面(AOP)</li>
<li>容器</li>
<li>轻量级</li>
</ul>
<h3 id="SpringMVC优点"><a href="#SpringMVC优点" class="headerlink" title="SpringMVC优点"></a>SpringMVC优点</h3><ul>
<li>清晰分离控制器视图与模型</li>
<li>高度灵活</li>
<li>提供控制器</li>
<li>支持多种视图技术：jsp，velocity，tiles，jsf</li>
<li>通过依赖注入配置控制器</li>
<li>容易测试</li>
<li>验证器作为应用程序对象，不依赖于SpringAPI 而 struts需要借助StrutsAPI ActionForm.validate()</li>
</ul>
<h3 id="Spring框架的七个模块"><a href="#Spring框架的七个模块" class="headerlink" title="Spring框架的七个模块"></a>Spring框架的七个模块</h3><ul>
<li>核心：提供基本功能，包含bean工厂 使用org.springframework.core包</li>
<li>DAO（数据访问对象）：通过Hibernate、JDBC等标准化数据访问，编写简单数据库代码，无需考虑打开关闭数据库，提供异常层次结构 使用org.springframework.dao包</li>
<li>ORM（关系映射）：将Spring框架与其他对象关系映射工具（Hibernate、iBatis）集成，<strong>构建在DAO模块之上</strong> 使用org.springframework.orm包</li>
<li>AOP：面向切面，实现事务管理与安全性等，借助XML配置文件在应用程序中声明企业服务，使用org.springframework.aop包</li>
<li>MVC：模型视图控制器，将模型应用、视图应用、用户界面分开实现松散耦合，可重用，可与其他MVC框架集成（struts等），使用org.springframework.web包</li>
<li>应用程序上下文：构建在<strong>核心模块之上</strong>，使Spring成为一个框架， 通过一致的SpringAPI获取对象与资源，基于bean工厂 支持消息、应用程序生命周期事件验证国际化，由Spring配置文件定义，为Spring框架提供上下文信息（bean定义、安全性、事务管理）还提供了一些企业级服务（JNDI、EJB、电子邮件、远程通信、日程安排），使用org.springframework.context包*</li>
<li>Web上下文：属于Web应用程序开发堆栈（该堆栈包括MVC模块）构建于<strong>应用程序上下文模块之上</strong>，提供创建Web应用程序的上下文，支持Spring框架与Struts，WebWorks，JSF等框架集成，使用org.springframework.web包</li>
</ul>
<h2 id="实现依赖注入"><a href="#实现依赖注入" class="headerlink" title="实现依赖注入"></a>实现依赖注入</h2><p>web应用程序由大量逻辑组件组成，这些逻辑组件被称为应用程序对象，作为实现web应用程序业务目标的内聚单元。spring通过依赖注入（DI）概念管理应用程序对象</p>
<h3 id="Spring框架提供容器"><a href="#Spring框架提供容器" class="headerlink" title="Spring框架提供容器"></a>Spring框架提供容器</h3><ul>
<li>Bean工厂：提供对DI的支持 使用org.springframework.beans.factory.BeanFactory接口定义</li>
<li>应用程序上下文：基于bean工厂，提供如与SpringAOP集成、国际化等 使用org.springframework.context.ApplicationContext接口定义</li>
</ul>
<h3 id="介绍bean工厂"><a href="#介绍bean工厂" class="headerlink" title="介绍bean工厂"></a>介绍bean工厂</h3><p>bean可以是Spring容器创建、管理的任何java对象或实例。bean工厂容器用于实例化、配置、管理bean，bean工厂创建的对象是完全配置、可使用、知道关系的，管理一创建对象生命周期也涉及bean工厂。</p>
<p>要实例化Web应用程序的bean工厂首先要加载bean配置文件，使用org.springframework.core.io.Resource接口定义的Rescource对象完成 可从不同位置加载bean配置文件。</p>
<h3 id="resource接口实现检索配置文件资源"><a href="#resource接口实现检索配置文件资源" class="headerlink" title="resource接口实现检索配置文件资源"></a>resource接口实现检索配置文件资源</h3><ul>
<li>org.springframework.core.io.ByteArrayResource 一组字节资源</li>
<li>org.springframework.core.io.ClassPathResource 指定路径*</li>
<li>org.springframework.core.io.FileSystemResource 指定文件系统</li>
<li>org.springframework.core.io.InputStreamResource 输入流</li>
<li>org.springframework.web.context.support.ServletContextResource servlet上下文*</li>
<li>org.springframework.core.io.UrlResource 给定URL</li>
</ul>
<h3 id="bean标记属性"><a href="#bean标记属性" class="headerlink" title="bean标记属性"></a>bean标记属性</h3><ul>
<li>id：唯一标识bean定义默认bean名称不可包含特殊字符</li>
<li>name：指定bean别名可包含特殊字符</li>
<li>class：指定bean类的全限定名</li>
<li>scope：指定bean作用域 有singleton或prototype</li>
</ul>
<h3 id="bean生命周期步骤"><a href="#bean生命周期步骤" class="headerlink" title="bean生命周期步骤"></a>bean生命周期步骤</h3><ol>
<li>实例化</li>
<li>填充属性</li>
<li>设置bean名称</li>
<li>设置bean工厂</li>
<li>预初始化</li>
<li>初始化bean</li>
<li>初始化后</li>
<li>bean可使用</li>
<li>销毁bean</li>
</ol>
<h3 id="应用程序上下文介绍"><a href="#应用程序上下文介绍" class="headerlink" title="应用程序上下文介绍"></a>应用程序上下文介绍</h3><p>应用程序上下文是高级容器，继承了BeanFactory接口的所有功能，所以ApplicationContext更常用，缺乏资源用bean工厂</p>
<h4 id="企业级功能"><a href="#企业级功能" class="headerlink" title="企业级功能"></a>企业级功能</h4><ul>
<li>提供解析文本消息的方式与消息国际化</li>
<li>提供加载图像之类文件资源的常规方法</li>
<li>将事件发布到作为侦听器注册的bean</li>
</ul>
<h4 id="应用程序上下文常用实现"><a href="#应用程序上下文常用实现" class="headerlink" title="应用程序上下文常用实现"></a>应用程序上下文常用实现</h4><ul>
<li>ClassPathXmlApplicationContext 指定路径找配置文件</li>
<li>FileSystemXmlApplicationContext 文件系统找配置文件</li>
<li>XmlWebApplicationContext web.xml上下文参数contextConfigLocation找配置文件</li>
</ul>
<p>ClassPathXmlApplicationContext例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"Sport/Spring-Config.xml"</span>);</span><br></pre></td></tr></table></figure>
<p>FileSystemXmlApplicationContext例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext = <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string">"C:/Sport/Spring-Config.xml"</span>);</span><br></pre></td></tr></table></figure>
<p>XmlWebApplicationContext例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext = <span class="keyword">new</span> XmlWebApplicationContext();</span><br></pre></td></tr></table></figure>
<p>bean工厂只有在调用getBean()时才创建bean， 应用程序上下文一旦启动就会预加载所有bean</p>
<h4 id="应用程序上下文bean生命周期步骤"><a href="#应用程序上下文bean生命周期步骤" class="headerlink" title="应用程序上下文bean生命周期步骤"></a>应用程序上下文bean生命周期步骤</h4><ol>
<li>实例化</li>
<li>填充属性</li>
<li>设置bean名称</li>
<li>设置bean工厂</li>
<li>设置应用程序上下文</li>
<li>预初始化</li>
<li>初始化bean</li>
<li>初始化后</li>
<li>bean可使用</li>
<li>销毁bean</li>
</ol>
<h3 id="注入应用程序对象"><a href="#注入应用程序对象" class="headerlink" title="注入应用程序对象"></a>注入应用程序对象</h3><p>应用程序对象之间创建和管理的过程形成了依赖注入DI核心并被成为装配</p>
<h4 id="完成装配的方式"><a href="#完成装配的方式" class="headerlink" title="完成装配的方式"></a>完成装配的方式</h4><ul>
<li>显示装配：根据配置文件中的显式声明</li>
<li>自动装配：由容器自动确定</li>
</ul>
<h4 id="显式装配"><a href="#显式装配" class="headerlink" title="显式装配"></a>显式装配</h4><p>可用设值注入(setter)和构造函数注入，通过\<property>元素配置，其中又可以注入简单值或引用其他bean</property></p>
<p>示例代码(setter)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SetterInject;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Player</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SetterInject;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FootballPlayer</span> <span class="keyword">implements</span> <span class="title">Player</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String football;</span><br><span class="line">    <span class="keyword">private</span> FootballBoots boots;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FootballPlayer</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.plintln(<span class="string">"I am playing with "</span> + football + <span class="string">" football."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFootball</span><span class="params">(String football)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.football = football;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBoots</span><span class="params">(FootballBoots boots)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.boots = boots;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SetterInject;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FootballBoots</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">wearBoots</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注入简单值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Kaka"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fotball"</span> <span class="attr">value</span>=<span class="string">"Adidas"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Forlan"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fotball"</span> <span class="attr">value</span>=<span class="string">"Nike"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SetterInject;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Predator</span> <span class="keyword">implements</span> <span class="title">FootballBoots</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Predator</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wearBoots</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.plintln(<span class="string">"I am wearing Adids predator boots."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>引用其他bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"predator"</span> <span class="attr">class</span>=<span class="string">"SetterInject.Predator"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Kaka"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fotball"</span> <span class="attr">value</span>=<span class="string">"Adidas"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"boots"</span> <span class="attr">ref</span>=<span class="string">"predator"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Forlan"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fotball"</span> <span class="attr">value</span>=<span class="string">"Nike"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"boots"</span> <span class="attr">ref</span>=<span class="string">"predator"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I am playing with Adidas football. I am wearing Adids predator boots.</span><br><span class="line">I am playing with Nike football. I am wearing Adids predator boots.</span><br></pre></td></tr></table></figure>
<p>示例代码(构造函数)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> SetterInject;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FootballPlayer</span> <span class="keyword">implements</span> <span class="title">Player</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> shirtNumber;</span><br><span class="line">   	<span class="function"><span class="keyword">public</span> <span class="title">FootballPlayer</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FootballPlayer</span><span class="params">(<span class="keyword">int</span> shirtNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shirtNumber = shirtNumber;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.plintln(<span class="string">"I am playing with "</span> + football + <span class="string">" football."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Kaka"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"7"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Forlan"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"21"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I am playing with shirt nubmer 7.</span><br><span class="line">I am playing with shirt nubmer 21.</span><br></pre></td></tr></table></figure>
<h4 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h4><p>紫铜装配通过设置对被装配bean配置autowire完成</p>
<h5 id="autowire属性"><a href="#autowire属性" class="headerlink" title="autowire属性"></a>autowire属性</h5><ul>
<li>byName： 寻找名称与被装配属性匹配的bean，找不到不匹配</li>
<li>byType：寻找类型与被装配属性类型匹配的bean找不到不装配，找到多个抛出org.springframework.beans.factory.UnsatisfiedDependencyException异常</li>
<li>constructor：尝试将容器中的一个或多个bean与被装配bean构造函数匹配，构造函数或bean中存在二义性抛出org.springframework.beans.factory.UnsatisfiedDependencyException异常</li>
<li>autodetect：如果有默认无参构造先尝试用constructor然后用byType尝试装配bean</li>
</ul>
<p>通过名称</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"boots"</span> <span class="attr">class</span>=<span class="string">"SetterInject.Predator"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Kaka"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span> <span class="attr">autowire</span>=<span class="string">"byName"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"football"</span> <span class="attr">value</span>=<span class="string">"Adidas"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过类型</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"boots"</span> <span class="attr">class</span>=<span class="string">"SetterInject.Predator"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Kaka"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span> <span class="attr">autowire</span>=<span class="string">"byType"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"football"</span> <span class="attr">value</span>=<span class="string">"Adidas"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果找到多个类型相符的bean将抛出异常，所以需要只有一个bean可以匹配自动装配的类型。</p>
<p>构造函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AutowireInject;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RugByPlayer</span> <span class="keyword">implements</span> <span class="title">Player</span></span>&#123;</span><br><span class="line">    privite RugByBoots rugByBoots;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> shirtNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RugByPlayer</span><span class="params">(RugByBoots rugByBoots)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rugByBoots = rugByBoots;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getShirtNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shirtNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShirtNumber</span><span class="params">(<span class="keyword">int</span> shirtNumber)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.shirtNumber = shirtNumber;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am playing with shirt number "</span> + shirtNumber + </span><br><span class="line">                           <span class="string">" and "</span> + rugByBoots.getBoots() + <span class="string">" rugby boots."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AutowireInject;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RugByBoots</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String boots;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBoots</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> boots;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetBoots</span><span class="params">(String boots)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.boots = boots;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Wilkinson"</span> <span class="attr">class</span>=<span class="string">"AutowireInject.RugByPlayer"</span> <span class="attr">autowire</span>=<span class="string">"constructor"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"shirtNumber"</span> <span class="attr">value</span>=<span class="string">"7"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"NikeBoots"</span> <span class="attr">class</span>=<span class="string">"AutowireInject.RugByBoots"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"boots"</span> <span class="attr">value</span>=<span class="string">"Nike"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I am playing with shirt number 7 and Nike rugby boots.</span><br></pre></td></tr></table></figure>
<p>如果有多个可被装配的bean会抛出异常，如果有多个构造函数也会抛出异常</p>
<p>自动检测</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id&#x3D;&quot;Kaka&quot; class&#x3D;&quot;SetterInject.FootballPlayer&quot; autowire&#x3D;&quot;autodetect&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>先构造函数后byType</p>
<h4 id="使用默认自动装配"><a href="#使用默认自动装配" class="headerlink" title="使用默认自动装配"></a>使用默认自动装配</h4><p>需要在beans元素中配置default-autowire</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-autowire</span>=<span class="string">"byType"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="显式装配与自动装配结合"><a href="#显式装配与自动装配结合" class="headerlink" title="显式装配与自动装配结合"></a>显式装配与自动装配结合</h4><p>可以对任何属性使用\<property>或\<constructor-arg>，会覆盖已经自动装配过的属性。</constructor-arg></property></p>
<p>使用byType时可以显式装配有二义性的属性如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Kaka"</span> <span class="attr">class</span>=<span class="string">"SetterInject.FootballPlayer"</span> <span class="attr">autowire</span>=<span class="string">"byType"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"football"</span> <span class="attr">value</span>=<span class="string">"Adidas"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"boots"</span> <span class="attr">value</span>=<span class="string">"boot2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"boot1"</span> <span class="attr">class</span>=<span class="string">"SetterInject.Predator"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"boot2"</span> <span class="attr">class</span>=<span class="string">"SetterInject.Predator"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>\<constructor-arg>不能与构造函数自动装配混合。</constructor-arg></p>
<h2 id="Spring与Web层集成"><a href="#Spring与Web层集成" class="headerlink" title="Spring与Web层集成"></a>Spring与Web层集成</h2><h3 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h3><h4 id="SpringMVC具有的胜过其他MVC框架的功能"><a href="#SpringMVC具有的胜过其他MVC框架的功能" class="headerlink" title="SpringMVC具有的胜过其他MVC框架的功能"></a>SpringMVC具有的胜过其他MVC框架的功能</h4><ul>
<li>可插拔视图技术：支持各种视图技术，如JSP、Tiles、JSF</li>
<li>将服务注入控制器：结合了Spring优点，如依赖注入与AOP，可以将业务层对象隐式注入控制器以减少用户界面和业务逻辑层之间代码的冗余</li>
<li>集成支持：支持与Struts与Hibernate等其他控件集成</li>
</ul>
<h4 id="MVC设计模式组成"><a href="#MVC设计模式组成" class="headerlink" title="MVC设计模式组成"></a>MVC设计模式组成</h4><ul>
<li>模型：应用程序存留的数据</li>
<li>视图：应用程序用户界面</li>
<li>控制器：负责接收用户请求并将其传递给模型进行操作，基于操作结果由控制器指向对应视图</li>
</ul>
<h4 id="SpringMVC处理用户请求利用的组件"><a href="#SpringMVC处理用户请求利用的组件" class="headerlink" title="SpringMVC处理用户请求利用的组件"></a>SpringMVC处理用户请求利用的组件</h4><ul>
<li>处理程序映射：使分发程序servlet能将传入请求转发到适当的控制器</li>
<li>控制器：处理请求生成响应（包括视图逻辑名称）</li>
<li>视图解析器：将控制器返回的视图逻辑名称解析为实际视图</li>
<li>视图：向用户显示响应</li>
</ul>
<h4 id="SpringMVC框架优点"><a href="#SpringMVC框架优点" class="headerlink" title="SpringMVC框架优点"></a>SpringMVC框架优点</h4><ul>
<li>易于测试</li>
<li>可重用的应用程序代码</li>
<li>简单强大的标记库</li>
<li>支持多种视图技术与Web框架</li>
</ul>
<h4 id="Web请求的生命周期"><a href="#Web请求的生命周期" class="headerlink" title="Web请求的生命周期"></a>Web请求的生命周期</h4><p>Web应用程序的web.xml包含关于如何处理某个Web请求的信息，当服务器收到请求将读取web.xml并将请求转发至负责处理的servlet</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">	G(用户请求) --1--&gt; A</span><br><span class="line">	A(分发程序servlet) --2--&gt;B(处理程序映射)</span><br><span class="line">    A -- 5 --&gt; E(视图解析器)</span><br><span class="line">    A -- 6 --&gt; F(视图)</span><br><span class="line">    A -- 3 --&gt; C(控制器) -- 4 --&gt; D(模型和视图) --&gt; A</span><br></pre></td></tr></table></figure>
<h5 id="请求生命周期"><a href="#请求生命周期" class="headerlink" title="请求生命周期"></a>请求生命周期</h5><ol>
<li>请求抵达分发程序servlet</li>
<li>分发程序servlet咨询一个或多个处理程序确定对应控制器</li>
<li>分发程序servlet将请求转发给控制器</li>
<li>控制器以逻辑视图名称与数据对象发送请求给分发程序servlet</li>
<li>分发程序servlet请求视图解析器将逻辑视图名称解析为视图</li>
<li>视图实现，交付模型数据并通过响应发送给浏览器</li>
</ol>
<h3 id="Web请求"><a href="#Web请求" class="headerlink" title="Web请求"></a>Web请求</h3><h4 id="使服务器支持Spring的MVC-Web应用程序中的Web请求"><a href="#使服务器支持Spring的MVC-Web应用程序中的Web请求" class="headerlink" title="使服务器支持Spring的MVC Web应用程序中的Web请求"></a>使服务器支持Spring的MVC Web应用程序中的Web请求</h4><ol>
<li>创建和配置分发程序servlet</li>
<li>创建对应控制器类</li>
<li>在分发程序servlet上下文配置中配置控制器</li>
<li>声明视图解析器将控制器与视图绑定</li>
<li>创建视图渲染请求页面</li>
</ol>
<h4 id="创建和配置分发程序servlet"><a href="#创建和配置分发程序servlet" class="headerlink" title="创建和配置分发程序servlet"></a>创建和配置分发程序servlet</h4><p>分发程序servlet由org.springframework.web.servlet.DispatherServlet类表示，DispatherServlet与Spring框架的ApplicationContext集成。</p>
<p>分发程序servlet需要在web.xml中通过\<servlet>与\<servlet-mapping>声明和配置</servlet-mapping></servlet></p>
<p>dispatcher-servlet.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.htm<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码*.hml表示扩展名为.hml的所有被请求URL都由分发程序servlet处理，若配置为*.* 表示分发servlet可以处理任何扩展名的所有被请求URL</p>
<h4 id="创建和配置控制器"><a href="#创建和配置控制器" class="headerlink" title="创建和配置控制器"></a>创建和配置控制器</h4><p>编写一个类并注解为@Controller,假设已经配置了分发程序servlet TickDispatcher，创建机票预定控制器BookController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controller;</span><br><span class="line"><span class="keyword">import</span> bookTickets.Passenger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.ModelMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> service.BookService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RquestMapping</span>(value=<span class="string">"/BookTickets.hmt"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BoolController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BookService <span class="title">getBookService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookService;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookService</span><span class="params">(BookService bookService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookService = bookService;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(method=RequestMethod.GET)</span><br><span class="line">    <span class="function">Public String <span class="title">processForm</span><span class="params">(ModelMap model)</span> </span>&#123;</span><br><span class="line">        Passenger p = <span class="keyword">new</span> Passenger();</span><br><span class="line">        model.addAttribute(<span class="string">"Passenger"</span>, p);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"BookTickets"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(method=RequestMethod.POST)</span><br><span class="line">    <span class="function">Public String <span class="title">processFrom</span><span class="params">(@ModelAttribute(value=<span class="string">"Passenger"</span>)</span> Passenger p, ModelMap model)</span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"helloMessage"</span>, bookService.sayHello(p.getNumTravellers()));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"BookConfirmed"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BookService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> service;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Congratulations!!! The tickets have been booked for "</span> + num + <span class="string">" travellers."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping()"></a>@RequestMapping()</h4><ul>
<li>value：指定类充当控制器的URL</li>
<li>method：指定http请求方法<ol>
<li>RequestMethod.GET</li>
<li>RequestMethod.POST</li>
</ol>
</li>
</ul>
<p>控制器不自己处理请求，而是将请求委托给对应service服务类如上述BokService。</p>
<p>控制器以org.springframework.ui.ModelMap类返回的ModelMap对象的形式将结构转发回浏览器</p>
<h4 id="ModelMap中addAttribute方法"><a href="#ModelMap中addAttribute方法" class="headerlink" title="ModelMap中addAttribute方法"></a>ModelMap中addAttribute方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ModelMap <span class="title">addAttribute</span><span class="params">(String attributeName, Object attributeValue)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>attributeName：要添加到ModelMap对象的属性名</li>
<li>attributeValue：要添加到ModelMap对象的对象</li>
</ul>
<h4 id="在分发程序servlet中配置控制器"><a href="#在分发程序servlet中配置控制器" class="headerlink" title="在分发程序servlet中配置控制器"></a>在分发程序servlet中配置控制器</h4><p>以上述BookController为例配置TickerDispatcher-servlet.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"BookController"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.ParameterizableViewControler"</span> <span class="attr">p:viewName</span>=<span class="string">"BookTickets"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"controller.BookController"</span> <span class="attr">p:bookService-ref</span>=<span class="string">"bookService"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="修改applicationcontext-xml通过注解创建控制器类的自动检测"><a href="#修改applicationcontext-xml通过注解创建控制器类的自动检测" class="headerlink" title="修改applicationcontext.xml通过注解创建控制器类的自动检测"></a>修改applicationcontext.xml通过注解创建控制器类的自动检测</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xis:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/context/spring-context-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">           "</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ReloadableResurceBundleMessageSource"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basename"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/messages"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">preperty</span> <span class="attr">name</span>=<span class="string">"cacheSeconds"</span> <span class="attr">value</span>=<span class="string">"3000"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"controller"</span>/&gt;</span> <span class="comment">&lt;!-- * --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span> <span class="comment">&lt;!-- * --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"bookService"</span> <span class="attr">class</span>=<span class="string">"service.BookService"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bookController"</span> <span class="attr">class</span>=<span class="string">"controller.BookController"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">porperty</span> <span class="attr">name</span>=<span class="string">"bookService"</span> <span class="attr">ref</span>=<span class="string">"bookService"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码中\<context:component-scan>标记用于在Spring中启用自动扫描base-package指定需扫描文件夹找出并注册带有@Controller注解的bean，\<mvc:annotation-driven>标记指定应用程序支持注解驱动的MVC控制器。</mvc:annotation-driven></context:component-scan></p>
<h4 id="将请求映射到控制器"><a href="#将请求映射到控制器" class="headerlink" title="将请求映射到控制器"></a>将请求映射到控制器</h4><p>Spring中处理映射由org.springframework.web.servlet.HandlerMapping接口表示</p>
<p><strong>映射实现类</strong></p>
<ul>
<li>BeanNameUrlHandlerMapping</li>
<li>SimpleUrlHandlerMapping</li>
<li>ControllerClassNameHandlerMapping</li>
</ul>
<p>考虑用户访问以下URL</p>
<ol>
<li><a href="http://myurl.com/account/showAccount" target="_blank" rel="noopener">http://myurl.com/account/showAccount</a></li>
<li><a href="http://myurl.com/account/createAccount" target="_blank" rel="noopener">http://myurl.com/account/createAccount</a></li>
<li><a href="http://myurl.com/account/deleteAccount" target="_blank" rel="noopener">http://myurl.com/account/deleteAccount</a></li>
</ol>
<h5 id="BeanNameUrlHandlerMapping"><a href="#BeanNameUrlHandlerMapping" class="headerlink" title="BeanNameUrlHandlerMapping"></a>BeanNameUrlHandlerMapping</h5><p>使用org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beanhandlermapping"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"/showAccount.htm"</span> <span class="attr">class</span>=<span class="string">"controller.ShowAccountController"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"/createAccount.htm"</span> <span class="attr">class</span>=<span class="string">"controller.CreateAccountController"</span>/&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"/deleteAccount.htm"</span> <span class="attr">class</span>=<span class="string">"controller.DeleteAccountController"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="SimpleUrlHandlerMapping"><a href="#SimpleUrlHandlerMapping" class="headerlink" title="SimpleUrlHandlerMapping"></a>SimpleUrlHandlerMapping</h5><p>使用org.springframework.web.servlet.handler.SimpleUrlHandlerMapping类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"showAccountController"</span> <span class="attr">class</span>=<span class="string">"controller.ShowAccountController"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"createAccountController"</span> <span class="attr">class</span>=<span class="string">"controller.CreateAccountController"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"deleteAccountController"</span> <span class="attr">class</span>=<span class="string">"controller.DeleteAccountController"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"simplehandlermapping"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapping"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"/showAccount.htm"</span>&gt;</span>showAccountController<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"/createAccount.htm"</span>&gt;</span>createAccountController<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"/deleteAccount.htm"</span>&gt;</span>deleteAccountController<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="ControllerClassNameHandlerMapping"><a href="#ControllerClassNameHandlerMapping" class="headerlink" title="ControllerClassNameHandlerMapping"></a>ControllerClassNameHandlerMapping</h5><p>使用org.springframework.web.servlet.handler.ControllerClassNameHandlerMapping类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ControllerClassNameHandlerMapping"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.ControllerClassNameHandlerMapping"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"controller.ShowAccountController"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"controller.CreateAccountController"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"controller.DeleteAccountController"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="将响应渲染至客户机"><a href="#将响应渲染至客户机" class="headerlink" title="将响应渲染至客户机"></a>将响应渲染至客户机</h4><ul>
<li>声明视图解析器</li>
<li>创建视图</li>
</ul>
<h5 id="声明视图解析器"><a href="#声明视图解析器" class="headerlink" title="声明视图解析器"></a>声明视图解析器</h5><p>Spring使用视图解析器将逻辑通名称解析为视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">	A(Controller) --&gt; B(DispatcherServlet) --&gt; C(View)</span><br><span class="line">	B --&gt;D(ViewResolver) --&gt; B</span><br></pre></td></tr></table></figure>
<p>Spring利用org.springframework.web.servlet.ViewResolver接口执行此任务</p>
<p><strong>ViewResolver接口</strong></p>
<ul>
<li>InternalResourceViewResolver</li>
<li>BeanNameViewResolver</li>
<li>ResourceBundleViewResolver</li>
<li>XmlViewResolver</li>
</ul>
<p>例如渲染JSP视图使用InternalResourceViewResolver</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span> <span class="attr">p:prefix</span>=<span class="string">"WEB-INF/jsp"</span> <span class="attr">p:suffix</span>=<span class="string">".jsp"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h5><p>Spring提供了自己的标记库来创建视图</p>
<p>使用spring标记库需要在视图中包含以下指令</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"http://www.springframework.org/tags"</span> prefix=<span class="string">"spring"</span> %&gt;</span><br></pre></td></tr></table></figure>
<p><strong>Spring标记库标记</strong></p>
<ul>
<li><p>\<spring:bing>将bean属性与表单组件绑定，包括一个path用于指定需要与表单组件绑定的bean属性路径</spring:bing></p>
<p>假设将input与Student bean的name绑定</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;spring:bind path=<span class="string">"Student.name"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"$&#123;status.expression&#125;"</span> value=<span class="string">"$&#123;status.value&#125;"</span>/&gt;</span><br><span class="line">&lt;/spring:bind&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>status.expression：用于返回表示bean属性的表达式，提交表单时Spring使用此表达式将表单组件与bean属性绑定</p>
</li>
<li><p>status.value：用于返回bean的属性值</p>
</li>
<li><p>status.nestedPath指定\<spring:bind>标记path的前缀路径</spring:bind></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">spring:nestedPath</span> <span class="attr">path</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring:bind</span> <span class="attr">path</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"$&#123;status.expression&#125;"</span> <span class="attr">value</span>=<span class="string">"$&#123;status.value&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">spring:bind</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring:bind</span> <span class="attr">path</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"$&#123;status.expression&#125;"</span> <span class="attr">value</span>=<span class="string">"$&#123;status.value&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">spring:bind</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">spring:nestedPath</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h2 id="实现AOP"><a href="#实现AOP" class="headerlink" title="实现AOP"></a>实现AOP</h2><h3 id="介绍AOP"><a href="#介绍AOP" class="headerlink" title="介绍AOP"></a>介绍AOP</h3><p>Web应用程序中有多个服务不属于应用程序的主业务逻辑的组成部分，如登录、安全性和事务管理，可以将这些服务视为横切关注点，因为它们趋向于横跨应用程序的多个模块。通过在应用程序的多个模块实现这些关注点可能会引入如下复杂性</p>
<ul>
<li>这些服务对于Web是必需的，需要在每个模块中实现，所以这些横切关注点代码在应用程序多个模块间是重复的，一旦更改需要更改每个模块，即使为这些横切关注点创建了单独的模块也需要在每个模块中写代码调用。</li>
<li>应用程序模块包含于核心功能无关的代码。</li>
</ul>
<p>为了降低复杂性简化程序结构Spring提供了面向方面编程（AOP）</p>
<h4 id="AOP功能"><a href="#AOP功能" class="headerlink" title="AOP功能"></a>AOP功能</h4><ul>
<li>将次要逻辑与主逻辑隔离增加模块性</li>
<li>提供封装如高速缓存、安全性、持久性、事务之类的横切关注点，将这些模块与核心应用程序分离</li>
<li>可以通过Java类中定义方法实现方面减少重复代码。</li>
<li>能够轻松删除先前定义的功能</li>
</ul>
<h4 id="AOP组件"><a href="#AOP组件" class="headerlink" title="AOP组件"></a>AOP组件</h4><ul>
<li>通知：是切入切点的时机，是方面的执行操作，用于表示应用程序的次要关注点。（订票中诸如验证用户、检查座位可用性、更新剩余票数之类的次要工作这些可以为前置通知或后置通知）</li>
<li>连接点：是应用程序的点或位置，可在该处插入通知。（主逻辑是订票所以包含订票逻辑的<strong>方法</strong>为连接点）</li>
<li>切入点：定义特定通知应用于哪个连接点。（订票所有通知的切入点为订票方法book()这个3-）</li>
<li>目标：是方面应用到的对象，所以执行应用程序主逻辑的类被称为目标对象。（实现订票主逻辑的类）</li>
<li>代理：包裹目标对象并截取该对象所作的所有调用</li>
<li>织入：在指定连接点将方面应用到目标对象以创建新的被代理对象的过程。</li>
</ul>
<h3 id="实现AOP-1"><a href="#实现AOP-1" class="headerlink" title="实现AOP"></a>实现AOP</h3><h4 id="注解实现"><a href="#注解实现" class="headerlink" title="注解实现"></a>注解实现</h4><p>SpringAOP借助AspectJ的语法  可以通过@EnableAspectJAutoProxy注解开启（SpringBoot引入依赖后默认开启）</p>
<p>可以通过@Aspect 将一个类声明为一个切面</p>
<p>@Pointcut声明切点，使用指示符execution匹配方法执行的连接点</p>
<p>使用@Before @AfterReturning @AfterThrowing @After @Around声明通知</p>
<p>为top.suvvm.dao包下所有方法添加前置通知</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuvvmAspect</span> </span>&#123;	<span class="comment">// 这是一个切面</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(execution(* top.suvvm.dao..*.*(..)))</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">xxxTransfer</span><span class="params">()</span></span>&#123;&#125;	<span class="comment">//这是一个切点里面包含一些连接点</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"xxxTransfer()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">advice</span><span class="params">()</span> </span>&#123;	<span class="comment">//这是一个前置通知</span></span><br><span class="line">        <span class="comment">// do some things</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Xml实现"><a href="#Xml实现" class="headerlink" title="Xml实现"></a>Xml实现</h4><p>以上述订票为例</p>
<p>用于订票book()方法的BookTicketInterface</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookTicketInterface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">book</span><span class="params">(String numTravelers, String trnPass)</span></span>;	<span class="comment">//乘客人数与交易密码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BookTicket</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AOP;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookTicket</span> <span class="keyword">implements</span> <span class="title">BookTicketInterface</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">book</span><span class="params">(String numTravelers, String trnPass)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 各种订票代码实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要实现AOP要执行以下操作</p>
<ul>
<li>创建通知</li>
<li>定义切入点</li>
<li>创建代理</li>
</ul>
<h5 id="创建通知"><a href="#创建通知" class="headerlink" title="创建通知"></a>创建通知</h5><p>通知种类</p>
<ul>
<li><p>前置通知：在连接点（book()）前执行，需导入org.springframework.aop.MethodBeforeAdvice接口，该接口包含before()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwalbe</span></span><br></pre></td></tr></table></figure>
<ol>
<li>method 通知将应用到的方法</li>
<li>args 调用方法是传递给方法的参数</li>
<li>target 方法调用的目标（对其调用方法的对象）</li>
</ol>
</li>
<li><p>返回后通知：在连接点正常执行完成后执行，需导入org.springframework.aop.AfterReturningAdvice接口，该接口包含afterReturning()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwalbe</span></span><br></pre></td></tr></table></figure>
<ol>
<li>returnValue 保存从被调用的方法返回的值</li>
</ol>
</li>
<li><p>抛出后通知：在抛出异常后执行，需导入org.springframework.aop.ThrowsAdvice接口，该接口包含afterThrowing()方法BookTicketApp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(Throwable throwable)</span></span></span><br></pre></td></tr></table></figure>
<ol>
<li>应由通知处理的异常</li>
</ol>
</li>
</ul>
<p>BookTicketApp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AOP;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookTicketApp</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String password;	<span class="comment">// 用户交易密码</span></span><br><span class="line">    <span class="keyword">private</span> String travelers;	<span class="comment">// 乘客数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassowrd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTravelers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     	<span class="keyword">return</span> travelers;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTravelers</span><span class="params">(String travelers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.travelers = travelers;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HandleRequestController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/BookTicket.htm"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandleRequestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(method=RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showView</span><span class="params">(ModelMap model)</span> </span>&#123;</span><br><span class="line">        BookTicketApp bt = <span class="keyword">new</span> BookTicketApp();</span><br><span class="line">        model.addAttribute(<span class="string">"book"</span>, bt);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"BookTicket"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(method=RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">processView</span><span class="params">(@ModelAttribute(<span class="string">"book"</span>)</span> BookTicketApp bt, ModelMap model) </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"AOP/Config.xml"</span>);</span><br><span class="line">        BookTicetInterface perf=(BookTickInterface)ctx.getBean(<span class="string">"bookProxy"</span>);</span><br><span class="line">        <span class="comment">// 如果用户验证成功将对于用户验证结果，总价格信息，奖励信息加入ModelMap</span></span><br><span class="line">        <span class="comment">// 否则将错误信息加入ModelMap</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"BookTicket"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要功能机票预定，次要工作验证用户、检查座位可用性、更新座位、奖励礼券等</p>
<p>SecondaryJob类</p>
<ol>
<li>验证用户</li>
<li>检查座位可用性</li>
<li>更新订票后的可用座位数</li>
<li>奖励礼券</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AOP;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondaryJob</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">authenticate</span><span class="params">(String pwd)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 成功记录 User is Authenticated</span></span><br><span class="line">        <span class="comment">// 失败记录 Authentiction Failed. Please Enter a Valid Transaction Password.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 验证座位</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkSeatsAvailability</span><span class="params">(String numTrav)</span></span>&#123;</span><br><span class="line">   		<span class="comment">// 对比传入的乘客数与座位总数</span></span><br><span class="line">        <span class="comment">// 成功记录成功信息</span></span><br><span class="line">        <span class="comment">// 失败记录失败信息</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新订票后的可用座位数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSeat</span><span class="params">(String numTrav)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 现有座位减去传入的乘客数</span></span><br><span class="line">        <span class="comment">// 上一步验证座位成功记录成功信息</span></span><br><span class="line">        <span class="comment">// 上一步验证座位失败不做记录</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 奖励方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rewardGift</span><span class="params">(String numTrav)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 验证座位且超过1000美元就记录奖励信息</span></span><br><span class="line">        <span class="comment">// 否则什么也不记录</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Spring配置文件Config.xml中配置SecondaryJob</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sj"</span> <span class="attr">class</span>=<span class="string">"AOP.SecondaeyJob"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>之后便是配置通知</strong></p>
<ul>
<li>使用java类</li>
<li>使用配置元素</li>
</ul>
<h5 id="使用JAVA类"><a href="#使用JAVA类" class="headerlink" title="使用JAVA类"></a>使用JAVA类</h5><p>创建SeconaryJobAdvice实现通知</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> AOP;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.AfterReturningAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.MethodBeforeAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondaryJonAdvice</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondaryJobAdvice</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span>,<span class="title">AfterReturningAdvice</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> SecondaryJob secondary;</span><br><span class="line">        <span class="comment">// 前置</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">            secondary.authenticate(args[<span class="number">1</span>].toString());</span><br><span class="line">            secondary.checkSeatsAvailability(args[<span class="number">0</span>].toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回后</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">            secondary.updateSeat(args[<span class="number">0</span>].toString());</span><br><span class="line">            secondary.rewardGift(args[<span class="number">0</span>].toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecondary</span><span class="params">(SecondaryJob secondary)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.secondary = secondary;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后需要在Spring配置文件Config.xml将上方类配置为bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"secondaryJobAdvice"</span> <span class="attr">class</span>=<span class="string">"AOP.SecondaryJobAdvice"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"secondary"</span> <span class="attr">ref</span>=<span class="string">"sj"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="使用配置元素"><a href="#使用配置元素" class="headerlink" title="使用配置元素"></a>使用配置元素</h5><p>可用使用Spring配置文件中的aop名称空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br></pre></td></tr></table></figure>
<p><strong>配置元素</strong></p>
<ul>
<li>\<aop:config>：SpringAop配置元素 用于定义所有AOP配置</aop:config></li>
<li>\<aop:aspect>：用于声明方面，具有引用Spring配置文件中定义的相应方面bean的ref属性</aop:aspect></li>
<li>\<aop:before>：用于定义前置通知</aop:before></li>
<li>\<aop:after-returning>：返回后通知</aop:after-returning></li>
<li>\<aop:atter-throwing>：抛出后通知</aop:atter-throwing></li>
<li>\<aop:around>：配置之前和返回后都执行的方法</aop:around></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"js"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"authenticate"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"checkSeatsAvailability"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"updateSeats"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"rewardGift"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="定义切入点"><a href="#定义切入点" class="headerlink" title="定义切入点"></a>定义切入点</h5><p>切入点在Srping配置文件中定义Spring提供了org.springframework.aop.support.JdkRegexpMethodPointcut类，该类允许使用正则表达式定义切入点，此类有一个名为pattern的属性，其value属性用于指定引用通知可以应用到的方法的特定模式</p>
<p>例如：value属性为PrimaryJob.*book的模式将把通知应用于PrimaryJob类中任何以book结尾的方法</p>
<p>为用户预定机票的方法名为book()这里将book指定为模式的切入点</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bookingPointCut"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.JdkRegexpMethodPointcut"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">prorerty</span> <span class="attr">neme</span>=<span class="string">"pattern"</span> <span class="attr">value</span>=<span class="string">".*book"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>定义了切入点后还需要定义将那些通知应用到该切入点，所以要创建将通知与切入点相链接的通知器，Spring提供org.springframework.aop.support.DefaultPointcutAdvisor类来创建通知器</p>
<p>以上方机票预定程序为例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"secondarryJobAdvisor"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.DefaultPointcutAdvisor"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"advice"</span> <span class="attr">ref</span>=<span class="string">"secondaryJobAdvice"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pointcut"</span> <span class="attr">ref</span>=<span class="string">"bookingPontCut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码创建了将secondaryJobAdvice bean与bookingPointCut bean所定义的切入点相链接的secondaryJobAdvisor bean</p>
<p>也可以使用Spring配置元素来定义切入点</p>
<p>\<aop:pointcut>元素用来定义切入点此元素包含名为expression的属性，此属性用于定义执行连接点方法的表达式，语法：</aop:pointcut></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression &#x3D; &quot;execution(regular_expression)&quot;</span><br></pre></td></tr></table></figure>
<p>regular_expression为精确确定需要执行哪种方法的切入点表达式</p>
<p>使用pointcut-ref属性可在多个通知元素之间引用切入点。</p>
<p>以机票预定程序为例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"js"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* book*())"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"authenticate"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"checkSeatsAvailability"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"updateSeats"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"rewardGift"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:pointcut</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="创建代理"><a href="#创建代理" class="headerlink" title="创建代理"></a>创建代理</h5><p>创建通知器后还需要创建调用该通知类的代理，代理充当通知、目标对象、连接点、切入点和通知器之间的链接，Spring提供了org.springframework.aop.config.ProxyFactory类</p>
<p>所需参数</p>
<ul>
<li>target：指定想要代理的目标对象</li>
<li>interceptorNames： 已在Spring配置文件中定义的通知器bean名称的列表</li>
<li>proxyInterfaces：指定应用程序主逻辑界面的名称</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"inst"</span> <span class="attr">class</span>=<span class="string">"AOP.BookTicket"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bookProxy"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.config.ProxyFactory"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">ref</span>=<span class="string">"inst"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span> <span class="attr">value</span>=<span class="string">"secondaryJovAdvisor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyInterface"</span> <span class="attr">value</span>=<span class="string">"AOP.BookTicketInterface"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建了bookProxy bean目标对象时主逻辑类BooKTicket通知器为secondaryJovAdvisor bean</p>
<p>主逻辑界面为声明book()方法的BookTicketInterface接口</p>
<p>要从HandleRequestController调用代理以订票要添加如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processView</span><span class="params">(@MedelAttribute(<span class="string">"book"</span>)</span> BookTicketApp bt, ModelMap model) </span>&#123;</span><br><span class="line">    ApplicationContext ctx = <span class="keyword">new</span> ClassPatchXmlApplicationContext(<span class="string">"AOP/Config.xml"</span>);</span><br><span class="line">    BookTicketInterface perf = (BootTicketInterface)ctx.getBean(<span class="string">"bootProxy"</span>);</span><br><span class="line">    perf.book(bt.getTravelers(), bt.getPassword());</span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="踩坑警告"><a href="#踩坑警告" class="headerlink" title="踩坑警告"></a>踩坑警告</h4><p>当开启springAOP功能时，spring将通过CDLIB生成连接点所在对象的子类作为代理类，CGLIB将直接生成字节码而不经过Java编译器，所生成的子类在构造时不会调用super()，也就是说代理类不会初始化任何成员变量，包括final类型的成员变量，所以使用方法调用连接点所在对象中的属性。</p>
<h2 id="将Spring与业务层和表示层集成"><a href="#将Spring与业务层和表示层集成" class="headerlink" title="将Spring与业务层和表示层集成"></a>将Spring与业务层和表示层集成</h2><h3 id="Spring集成JSF"><a href="#Spring集成JSF" class="headerlink" title="Spring集成JSF"></a>Spring集成JSF</h3><h4 id="解析JSF-Bean"><a href="#解析JSF-Bean" class="headerlink" title="解析JSF Bean"></a>解析JSF Bean</h4><p>在JSF配置文件faces-config.xml声明JSF受管Bean JsfBean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">managed-bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">managed-bean-name</span>&gt;</span>JsfBean<span class="tag">&lt;/<span class="name">meanaged-bean-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">managed-bean-class</span>&gt;</span>JsfManagedBean<span class="tag">&lt;/<span class="name">meanaged-bean-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">managed-bean-scop</span>&gt;</span>request<span class="tag">&lt;/<span class="name">managed-bean-scop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">managed-bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="添加Spring框架"><a href="#添加Spring框架" class="headerlink" title="添加Spring框架"></a>添加Spring框架</h4><p>在jsf应用程序中添加Spring框架需要在web.xml中提供applicationContext.xml的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上段代码是在web.xml中声明ContextLoaderListener侦听器类以加载Spring上下文，之后applicationContext.xml中声明的bean将在整个应用程序中可见</p>
<p>之后还要声明程序分发servlet</p>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.htm<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="解析Spring-Bean"><a href="#解析Spring-Bean" class="headerlink" title="解析Spring Bean"></a>解析Spring Bean</h4><p>为了调用Spring应用程序上下文中声明的Spring bean，Spring框架提供org.springframework.web.jsf.el.SpringBeanFaccesELResolver类此类在faces-config.xml文件的\<el-resover>中指定</el-resover></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">el-resolver</span>&gt;</span>org.springframework.web.jsf.el.SpringBeanFacesELResolver<span class="tag">&lt;/<span class="name">el-resolver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码声明的SpringBeanFacesELResolver bean变量解析器首先尝试从Spring应用上下文文件解析bean，如果不能解析bean，解析器将查找JSFbean变量解析器中是否有同名bean。</p>
<p>JSF受管bean JsfBean在Spring applicationContext.xml中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"JsdBean"</span> <span class="attr">class</span>=<span class="string">"JsfManagedBean"</span> <span class="attr">scope</span>=<span class="string">"request"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Spring集成Hibernate"><a href="#Spring集成Hibernate" class="headerlink" title="Spring集成Hibernate"></a>Spring集成Hibernate</h3><p>Hubernate是ORM（对象关系映射工具）Spring位于应用程序类和ORM之间，集成后可将Hibernate对象作为Spring bean使用。</p>
<h4 id="Hibernate功能"><a href="#Hibernate功能" class="headerlink" title="Hibernate功能"></a>Hibernate功能</h4><ul>
<li>提供对象\关系映射</li>
<li>支持基本面向对象原则</li>
<li>提供透明持久性</li>
<li>独立于数据库平台</li>
<li>提供Hibernate查询语言（HQL）</li>
<li>支持查询高速缓存，提供统计信息</li>
<li>受常用ide支持</li>
<li>提供xml保存映射信息</li>
<li>可以在受管和非受管环境运行，也可以在应用服务器容器外部和独立应用程序内部运行</li>
<li>提供有助于发现已被修改的对象的攒肚数据检查的功能</li>
</ul>
<h4 id="实现ORM"><a href="#实现ORM" class="headerlink" title="实现ORM"></a>实现ORM</h4><p>要将Spring与Hibernate集成需要</p>
<ul>
<li>在Spring中配置SessionFactory对象</li>
<li>使用数据访问对象DAO访问和更新数据</li>
</ul>
<h5 id="在Spring中配置SessionFactory对象"><a href="#在Spring中配置SessionFactory对象" class="headerlink" title="在Spring中配置SessionFactory对象"></a>在Spring中配置SessionFactory对象</h5><p>首先需要创建Spring配置文件spring-hibernate.xml</p>
<p>之后使用Spring提供的org.springframework.orm.hibernate4.LocalSessionFactoryBean类声明会话工厂</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mySessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.LocalSessionFactoryBean"</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"hibernate.cfg.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上方声明了带有id mySessionFactory的会话工厂bean 为配置此bean，提供了Hibernate配置文件的位置作为configLocation属性的值</p>
<p>hibernate.cfg.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding-"UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration P	ublic 	"-//Hibernate/Hibernate Configuration DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.DerbyDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.contection.driver_class"</span>&gt;</span>org.apache.deerby.jdbc.ClientDriver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:derby://localhost:1527/University<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.contection.username"</span>&gt;</span>university<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.contection.password"</span>&gt;</span>password<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"university/Coursedetaills.hbm.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码与已有University数据库建立连接，Coursedetail.hbm.xml文件包含带有Coursedetails类的COURSEDETAILS表的映射信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"nuiversity.Coursedetails"</span> <span class="attr">table</span>=<span class="string">"COURSEDETAILS"</span> <span class="attr">schema</span>=<span class="string">"UNIVERSITY"</span>&gt;</span>			<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"courseid"</span> <span class="attr">type</span>=<span class="string">"string"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"COURSEID"</span> <span class="attr">length</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"assigned"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"courseduration"</span> <span class="attr">type</span>=<span class="string">"string"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"COURSENAME"</span> <span class="attr">length</span>=<span class="string">"20"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"courseeligibility"</span> <span class="attr">type</span>=<span class="string">"string"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"COURSEFEE"</span> <span class="attr">length</span>=<span class="string">"20"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"coursefee"</span> <span class="attr">type</span>=<span class="string">"string"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"COURSEFEE"</span> <span class="attr">length</span>=<span class="string">"20"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>DAO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Criteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuaration;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseDetailsDAO</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SessionFactory sessionFactory;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionFactory</span><span class="params">(SessionFactory sessionFactory)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sessionFactory = sessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CourseDetailsDAO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getcourseByName</span><span class="params">(String courseName)</span></span>&#123;</span><br><span class="line">        List&lt;Coursedetails&gt; courselist=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Session session = sessionFactory.openSession();</span><br><span class="line">            org.hibernate.Transaction tx = session.beginTransaction();</span><br><span class="line">            Criteria criteria = session.createCriteria(Coursedetails.class).add(Restrictions.eq(<span class="string">"coursename"</span>, courseName));</span><br><span class="line">            courselist = (List&lt;Coursedetails&gt; criteria.list());</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStrackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> courselist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码创建了DAO类CourseDetailsDAO。此类创建了SessionFactory对象并使用该对象打开了一个会话以从数据库中检索数据</p>
<p>除了DAO还需要再spring-hibernate.xml中将其声明为bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"courseDetailsDAO"</span> <span class="attr">class</span>=<span class="string">"unversity.CourseDetails.DAO"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"mySessionFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以用以下代码像访问其他Spring bean一样访问该bean及其方法</p>
<p>CourseDetailDAO类的getcourseByName()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext apc = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"university/spring-hibernate.xml"</span>);</span><br><span class="line">CourseDetailsDAO courseDao=(CourseDetailsDAO)apc.getBean(<span class="string">"courseDeatilsDao"</span>);</span><br><span class="line">List&lt;Coursedetails&gt; courses = <span class="keyword">new</span> ArraryList&lt;Coursedetails&gt;();</span><br><span class="line">courses = courseDao.getcourseByName(cName);</span><br></pre></td></tr></table></figure>
<h2 id="管理事务"><a href="#管理事务" class="headerlink" title="管理事务"></a>管理事务</h2><h3 id="事务的功能"><a href="#事务的功能" class="headerlink" title="事务的功能"></a>事务的功能</h3><p>事务将任意数量的单个操作组成组，从而使整个过程看起来是一个工作逻辑单元。</p>
<h4 id="事务的ACID属性"><a href="#事务的ACID属性" class="headerlink" title="事务的ACID属性"></a>事务的ACID属性</h4><ul>
<li>原子性：执行所有数据修改或不执行任何数据修改</li>
<li>一致性：成功完成事务后所以数据均处于一致状态。关系数据库中的所有规则必须均应用到事务中的修改，以维护整个数据的完整性</li>
<li>隔离性： 每个事务执行都必须看起来好像独立于在同一环境中并发运行的其他事务</li>
<li>持久性：完成的事务对数据库所做的任何更改在系统中永久有效，因此由于完成的事务在数据中做的任何更改甚至在系统故障的情况下也得以保持，这由日志备份和恢复事务日志的概念所确保。</li>
</ul>
<h3 id="事务的属性"><a href="#事务的属性" class="headerlink" title="事务的属性"></a>事务的属性</h3><ul>
<li>传播行为</li>
<li>隔离级别</li>
<li>只读</li>
<li>事务超时</li>
<li>回滚规则</li>
</ul>
<h4 id="传播行为"><a href="#传播行为" class="headerlink" title="传播行为"></a>传播行为</h4><p>传播行为定义为org.springframework.transactionDefintion接口中的常量</p>
<ul>
<li>PROPAGATION_MANDATORY 当前方法必须在事务内运行，如果没有任何现有事务在运行将抛出异常</li>
<li>PROPAGATION_REQUIRED 当前方法必须在事务内运行，如果由现有事务正在运行，那么该方法将在事务内运行，如果没有事务在运行将开启新事务</li>
<li>PROPAGATION_NOT_SUPPORTED 当前方法不应该在事务内运行，如果有某个现有事务正在进行，那么它将暂挂直到方法的持续时间结束。</li>
<li>PROPAGATION_REQUIRED_NEW 当前方法必须在自己的事务中运行，因此将开始一个新事物，但是如果有某个现有事务正在进行，那么它将暂挂直到方法的持续时间结束。</li>
<li>PROPAGATION_SUPPORTS 当前事务不需要运行事务，但如果有某个事务正在运行，当前方法可以在其内运行</li>
<li>PROPAGATION_NESTED 如果有某个现有事务正在运行，方法应在嵌套事务内运行，嵌套事务可以被提交，也可以单独从外围事务中回归，如果不存在外围事务那么它的行为像PROPAGATION_REQUIRED 一样</li>
</ul>
<h4 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h4><p>有多个事务并发运行可能导致</p>
<ul>
<li>脏读：当一个事务读取已由另一个事务写入但是尚未提交的数据时发生，如果稍后回滚更改那么第一个事务所获得的数据将无效。</li>
<li>不可重复读：当事务两次或多次执行同一查询而每次检索的数据都不同时发生。由于有另一个并发事务正在更新数据</li>
<li>幻象度：当事务T1度多行数据而并发事务T2同时插入更多行时发生，进行后续查询时第一个事务T1发现了原先不在该处的更多行</li>
</ul>
<p>为了避免上述问题，事务应该彼此完全隔离，因此Spring提供了几种隔离级别</p>
<ul>
<li>ISOLATION_DEFAULT 使用底层数据存储的默认隔离级别，默认隔离级别可以是任何隔离级别</li>
<li>ISOLATION_READ_UNCOMMITTED 允许事务读取尚未由其他事务提交的更改，可能会导致脏读、幻象读和不可重复读</li>
<li>ISOLATION_READ_COMMITTED 允许事务仅读取已由其他事务提交的那些更改，可以防止脏读，但幻象读和不可重复读仍会发生</li>
<li>ISOLATION_REPEATABLE_READ 确保事务从同一字段执行多次读取将生成同一结果，其他事务在正在进行的事务读取期间对此字段所作的任何更新都将被禁止，可以防止脏读、不可重复读，但幻象读仍可能发生</li>
<li>ISOLATION_SERIALIZABLE 这是完全符合ACID的隔离级别，可以确保防止发生所有问题，在当前事务的持续时间中，其他并发事务不能访问同一数据表，是所有隔离级别中最慢的一种。</li>
</ul>
<p>只读</p>
<p>只读事务不修改任何事务</p>
<p>事务超时</p>
<p>声明事务在特定时间段后自动回滚，防止死锁</p>
<p>回滚规则</p>
<p>指定那些异常导致事务回滚</p>
<h2 id="实现事务"><a href="#实现事务" class="headerlink" title="实现事务"></a>实现事务</h2><h3 id="定义事务管理器"><a href="#定义事务管理器" class="headerlink" title="定义事务管理器"></a>定义事务管理器</h3><p>Spring提供了用于所有事务管理器的一般接口，PlatformTransactionManager接口，封装了事务管理的核心功能并提供以下三种方法管理事务</p>
<ul>
<li>getTransaction() ：根据指定传播行为返回当前活动的事务或创建新事务</li>
<li>commit()：将给定事务提交至数据存储</li>
<li>rollback() ：回滚给定事务</li>
</ul>
<p>与不同事务管理API一同使用</p>
<ul>
<li>JDBC：DataSourceTransactionManager</li>
<li>JTA：JtaTransactionManager</li>
<li>Hibernate：HibernateTransactionManager</li>
<li>JPA：JpaTransactionManager</li>
<li>JDO：JdoTransactionManager</li>
</ul>
<p>使用事务管理器需要在Spting配置文件中声明为bean，如使用Hibernate</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"mySessionFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>声明了一个将事务管理委托给Hibernate事务的事务管理器，需要设置sessionFactory属性以便底层事务管理器可以使用指定会话工厂创建事务</p>
<p>mySessionFactory</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mySessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.srpingframework.orm.hibernate4.LocalSessionFactory"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"org.apache.derby.jdbc.ClientDriver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">value</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上方声明了mySessionFactorybean保存通过org.springframework.jdbc.datasource.DiverManagerDataSource类声明的数据源bean的引用</p>
<p>数据源bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DiverManagerDataSource"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">class</span>=<span class="string">"org.apache.derby.jdbc.DlientDriver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:derby://localhost:1527/Sample"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"Sample"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"passowrd"</span> <span class="attr">value</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>声明dataSource bean保存了在Hibernate配置文件中声明的数据源信息</p>
<h3 id="使用配置管理元素"><a href="#使用配置管理元素" class="headerlink" title="使用配置管理元素"></a>使用配置管理元素</h3><p>要声明事务需要在Spring配置文件中添加tx名称空间，由于事务作为方面实现所以也要添加aop名称空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xmlns:tx&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx&quot;</span><br><span class="line">xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br></pre></td></tr></table></figure>
<p>tx模式和aop模式位置(beans)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xis:schemaLocation="http://www.springframework.org/schema/beans</span><br><span class="line">           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">           http://www.springframework.org/schema/aop</span><br><span class="line">           http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</span><br><span class="line">           http://www.springframework.org/schema/tx</span><br><span class="line">           http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span><br></pre></td></tr></table></figure>
<p>tx名称空间提供的xml配置元素</p>
<ul>
<li>tx:advice：创建调用事务管理器的通知，每个事务通知都要在配置文件中有一个标识符和到事务管理器的引用</li>
<li>tx:attributes：设置事务属性描述事务行为</li>
<li>tx:method：定义一个或多个方法的事务属性，策略：<ul>
<li>name：指定方法的名称（*指定所有方法）</li>
<li>propagation：定义事务传播规则</li>
<li>isolation：设置用于事务的隔离级别</li>
<li>timeout：超时时间（秒）</li>
<li>read-only：只读</li>
<li>roolback-for：回滚异常列表</li>
<li>no-rollback-for：不需要回滚的异常列表</li>
</ul>
</li>
</ul>
<p>以机场订票为例</p>
<p>PaymentServices接口声明了方法bookTicket()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> testl;</span><br><span class="line">……</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentService</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> bookTicket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BookingDAO定义bookTicket()，使用当前会话工厂创建事务预定机票更新可用座位数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookingDAO</span> <span class="keyword">implements</span> <span class="title">PaymentServices</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SessionFActory sessionFactory;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookingDAO</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionFactory</span><span class="params">(SessionFactory sessionFactory)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sessionFactory = sessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bookTicket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        org.hibernate.Transaction tx = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Session session = sessionFactory.openSession();</span><br><span class="line">            tx = session.beginTransaction();</span><br><span class="line">            tx.commit()</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tx != <span class="keyword">null</span>)&#123;</span><br><span class="line">                tx.rollback();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Spring配置文件中装配BookingDAO</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transaction"</span> <span class="attr">class</span>=<span class="string">"test.BookingDAO"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"mySessionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>现在可用tx:adivce元素声明事务策略</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txadvide"</span> <span class="attr">transcation-manager</span>=<span class="string">"txManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>事务管理器引用称为txManager，所有方法都必须在事务内执行；否则抛出异常</p>
<p>在aop:config元素声明一个通知器将通知与切入点关联</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pp"</span> <span class="attr">expression</span>=<span class="string">"execution(*test.PaymentService.*())"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txadvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上方创建了一个一个切入点和一个通知器。pointcut属性使用切入点表达式来指示此通知器应通知PaymentServices接口的所有方法，但是事务内实际运行的方法由事务通知定义，该通知从通知器的advice-ref属性引用。</p>
<p>在Spring配置文件中配置事务总结</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mySessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.LocalSessionFactoryBean"</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"hibernate.cfg.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DiverManagerDataSource"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">class</span>=<span class="string">"org.apache.derby.jdbc.DlientDriver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:derby://localhost:1527/Sample"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"Sample"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"passowrd"</span> <span class="attr">value</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txadvide"</span> <span class="attr">transcation-manager</span>=<span class="string">"txManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pp"</span> <span class="attr">expression</span>=<span class="string">"execution(*test.PaymentService.*())"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txadvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">……</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.HibernaetTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"mySessionFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transaction"</span> <span class="attr">class</span>=<span class="string">"test.BookingDAO"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"mySessonFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>现在需要调用trasaction bean将返回一个 为此bean启用了事务管理的代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"Config.xml"</span>);</span><br><span class="line">PaymentServices perf=(PaymentServices)ctx.getBean(<span class="string">"transaction"</span>);</span><br><span class="line">pref.bookTicket();</span><br></pre></td></tr></table></figure>
<p>上述代码在应用程序上下文对象ctx中检索了配置文件Config.xml的引用 transaction bean引用返回代理对象perf用于执行transaction bean的bookTicket()方法</p>
<p>使用注解配置事务</p>
<p>Spring使用org.springframework.transction.anntation.Transactional类的@Transactional元素并提供tx:annotation-driven元素支持注解驱动的事务管理，其具有transaction-amager属性，此属性指定对将调用其以实现事务的现有PlatformTransactionManager bean的引用</p>
<p>@Transactional注解属性</p>
<ul>
<li>propagation 类型：org.springframework.annotation.transaction.propagation 指定要使用的事务传播</li>
<li>isolation 类型org.springframework.annotation.transaction.isolation 设置隔离级别</li>
<li>timeout 类型 int 指定超时时间</li>
<li>readOnly 类型 boolean 是否为只读事务 </li>
<li>onRollbackFor 类型 java.lang.class<T> 不回滚的异常列表</T></li>
<li>rollbackFor 类型 java.lang.class<T> 回滚的异常列表</T></li>
</ul>
<p>@Transactional默认设置</p>
<ul>
<li>传播设置：PROPAGATION_REQUIRED</li>
<li>隔离级别：ISOLATION_DEFAULT</li>
<li>事务是读写事务</li>
<li>事务超时为底层事务系统默认超时时间或者不支持超时</li>
</ul>
<p>使用注解的BookDAO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookingDAO</span> <span class="keyword">implements</span> <span class="title">PaymentServices</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SessionFActory sessionFactory;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookingDAO</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionFactory</span><span class="params">(SessionFactory sessionFactory)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sessionFactory = sessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED, readOnly = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bookTicket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        org.hibernate.Transaction tx = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Session session = sessionFactory.openSession();</span><br><span class="line">            tx = session.beginTransaction();</span><br><span class="line">            tx.commit()</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tx != <span class="keyword">null</span>)&#123;</span><br><span class="line">                tx.rollback();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在配置文件中只需指定tx:annotation-driven元素并为其提供事务管理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"txManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mySessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.LocalSessionFactoryBean"</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"hibernate.cfg.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DiverManagerDataSource"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">class</span>=<span class="string">"org.apache.derby.jdbc.DlientDriver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:derby://localhost:1527/Sample"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"Sample"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"passowrd"</span> <span class="attr">value</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">……</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.HibernaetTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"mySessionFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transaction"</span> <span class="attr">class</span>=<span class="string">"test.BookingDAO"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"mySessonFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/22/PTA-%E5%A4%A9%E6%A2%AF%E8%B5%9B-L3-005-%E5%9E%83%E5%9C%BE%E7%AE%B1%E5%88%86%E5%B8%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/22/PTA-%E5%A4%A9%E6%A2%AF%E8%B5%9B-L3-005-%E5%9E%83%E5%9C%BE%E7%AE%B1%E5%88%86%E5%B8%83/" class="post-title-link" itemprop="url">PTA (天梯赛) L3-005 垃圾箱分布</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-22 22:20:33" itemprop="dateCreated datePublished" datetime="2019-11-22T22:20:33+08:00">2019-11-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">算法相关</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="L3-005-垃圾箱分布-30-分"><a href="#L3-005-垃圾箱分布-30-分" class="headerlink" title="L3-005 垃圾箱分布 (30 分)"></a>L3-005 垃圾箱分布 (30 分)</h2><p>大家倒垃圾的时候，都希望垃圾箱距离自己比较近，但是谁都不愿意守着垃圾箱住。所以垃圾箱的位置必须选在到所有居民点的最短距离最长的地方，同时还要保证每个居民点都在距离它一个不太远的范围内。</p>
<p>现给定一个居民区的地图，以及若干垃圾箱的候选地点，请你推荐最合适的地点。如果解不唯一，则输出到所有居民点的平均距离最短的那个解。如果这样的解还是不唯一，则输出编号最小的地点。</p>
<h3 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h3><p>输入第一行给出4个正整数：<em>N</em>（≤103）是居民点的个数；<em>M</em>（≤10）是垃圾箱候选地点的个数；<em>K</em>（≤104）是居民点和垃圾箱候选地点之间的道路的条数；<em>D**S</em>是居民点与垃圾箱之间不能超过的最大距离。所有的居民点从1到<em>N</em>编号，所有的垃圾箱候选地点从<em>G</em>1到<em>G**M</em>编号。</p>
<p>随后<em>K</em>行，每行按下列格式描述一条道路：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P1 P2 Dist</span><br></pre></td></tr></table></figure>
<p>其中<code>P1</code>和<code>P2</code>是道路两端点的编号，端点可以是居民点，也可以是垃圾箱候选点。<code>Dist</code>是道路的长度，是一个正整数。</p>
<h3 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h3><p>首先在第一行输出最佳候选地点的编号。然后在第二行输出该地点到所有居民点的最小距离和平均距离。数字间以空格分隔，保留小数点后1位。如果解不存在，则输出<code>No Solution</code>。</p>
<h3 id="输入样例1："><a href="#输入样例1：" class="headerlink" title="输入样例1："></a>输入样例1：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">4 3 11 5</span><br><span class="line">1 2 2</span><br><span class="line">1 4 2</span><br><span class="line">1 G1 4</span><br><span class="line">1 G2 3</span><br><span class="line">2 3 2</span><br><span class="line">2 G2 1</span><br><span class="line">3 4 2</span><br><span class="line">3 G3 2</span><br><span class="line">4 G1 3</span><br><span class="line">G2 G1 1</span><br><span class="line">G3 G2 2</span><br></pre></td></tr></table></figure>
<h3 id="输出样例1："><a href="#输出样例1：" class="headerlink" title="输出样例1："></a>输出样例1：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">G1</span><br><span class="line">2.0 3.3</span><br></pre></td></tr></table></figure>
<h3 id="输入样例2："><a href="#输入样例2：" class="headerlink" title="输入样例2："></a>输入样例2：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2 1 2 10</span><br><span class="line">1 G1 9</span><br><span class="line">2 G1 20</span><br></pre></td></tr></table></figure>
<h3 id="输出样例2："><a href="#输出样例2：" class="headerlink" title="输出样例2："></a>输出样例2：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No Solution</span><br></pre></td></tr></table></figure>
<p>作者: 陈越</p>
<p>单位: 浙江大学</p>
<p>时间限制: 200 ms</p>
<p>内存限制: 64 MB</p>
<p>代码长度限制: 16 KB</p>
<p>这是个中规中矩的最短路题目，没有要求记录路径，只是在最后结果判断时有些许繁琐。</p>
<p>输入时需要判断一下输入的时数字还是垃圾桶候选点，PTA是支持c11的，c11的string封装了stringToInt的函数std::stoi所以在输入时将P1与P2全部以string类型读入之后进行处理即可。</p>
<p>处理函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">toInt</span><span class="params">(<span class="built_in">string</span> inp)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(inp[<span class="number">0</span>] != <span class="string">'G'</span>)</span><br><span class="line">        <span class="keyword">return</span> stoi(inp);</span><br><span class="line">    <span class="keyword">if</span>(inp.size() == <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> inp[<span class="number">1</span>] - <span class="string">'0'</span> + n;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里起点的个数最多只有10个，所以直接遍历起点执行dijkstra即可。</p>
<p>dijkstra</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> bg)</span></span>&#123;</span><br><span class="line">    fill(d, d +MAXN, INF);</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">    d[bg] = <span class="number">0</span>;</span><br><span class="line">    priority_queue&lt;Node&gt; Q;</span><br><span class="line">    Q.push(Node&#123;bg, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!Q.empty()) &#123;</span><br><span class="line">        Node top = Q.top();</span><br><span class="line">        <span class="keyword">int</span> u = top.v;</span><br><span class="line">        Q.pop();</span><br><span class="line">        <span class="keyword">if</span>(vis[u])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        vis[u] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : Adj[u]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = i.v;</span><br><span class="line">            <span class="keyword">int</span> dis = i.dis;</span><br><span class="line">            <span class="keyword">if</span>(!vis[v] &amp;&amp; d[u] + dis &lt; d[v])&#123;</span><br><span class="line">                d[v] = d[u] + dis;</span><br><span class="line">                Q.push(Node&#123;v,d[v]&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意最终要求中最优为存在最长最短距离最长的最短路，若有多个最长最短距离相等的答案则取其中到每个点平均值最小的，若依旧有多个解则取其中垃圾桶标号最小的。</p>
<p>AC代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span>+<span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e7</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> d[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="keyword">int</span> n, m, k, ds;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, dis;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp;tNode) <span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dis &gt; tNode.dis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;Node&gt; Adj[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">toInt</span><span class="params">(<span class="built_in">string</span> inp)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(inp[<span class="number">0</span>] != <span class="string">'G'</span>)</span><br><span class="line">        <span class="keyword">return</span> stoi(inp);</span><br><span class="line">    <span class="keyword">if</span>(inp.size() == <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> inp[<span class="number">1</span>] - <span class="string">'0'</span> + n;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> bg)</span></span>&#123;</span><br><span class="line">    fill(d, d +MAXN, INF);</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">    d[bg] = <span class="number">0</span>;</span><br><span class="line">    priority_queue&lt;Node&gt; Q;</span><br><span class="line">    Q.push(Node&#123;bg, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!Q.empty()) &#123;</span><br><span class="line">        Node top = Q.top();</span><br><span class="line">        <span class="keyword">int</span> u = top.v;</span><br><span class="line">        Q.pop();</span><br><span class="line">        <span class="keyword">if</span>(vis[u])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        vis[u] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : Adj[u]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = i.v;</span><br><span class="line">            <span class="keyword">int</span> dis = i.dis;</span><br><span class="line">            <span class="keyword">if</span>(!vis[v] &amp;&amp; d[u] + dis &lt; d[v])&#123;</span><br><span class="line">                d[v] = d[u] + dis;</span><br><span class="line">                Q.push(Node&#123;v,d[v]&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> p1, p2;</span><br><span class="line">    <span class="keyword">int</span> dis;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; k &gt;&gt; ds;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; p1 &gt;&gt; p2 &gt;&gt; dis;</span><br><span class="line">        Adj[toInt(p1)].push_back(Node&#123;toInt(p2), dis&#125;);</span><br><span class="line">        Adj[toInt(p2)].push_back(Node&#123;toInt(p1), dis&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">-1</span>,ansMin = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">double</span> ansSum = INF;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt; n + m + <span class="number">1</span>; i++) &#123;</span><br><span class="line">        dijkstra(i);</span><br><span class="line">        <span class="keyword">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">double</span> nowSum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> nowMin = INF;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n + <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(d[j] &gt; ds)&#123;</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(d[j] &lt; nowMin)&#123;</span><br><span class="line">                nowMin = d[j];</span><br><span class="line">            &#125;</span><br><span class="line">            nowSum += d[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nowMin &gt; ansMin)&#123;</span><br><span class="line">                ans = i;</span><br><span class="line">                ansMin = nowMin;</span><br><span class="line">                ansSum = nowSum;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nowMin == ansMin) &#123;</span><br><span class="line">                <span class="keyword">if</span>(ansSum &gt; nowSum)&#123;</span><br><span class="line">                    ans = i;</span><br><span class="line">                    ansSum = nowSum;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ans == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"No Solution\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">'G'</span> &lt;&lt; ans-n &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.1f %.1f\n"</span>, (<span class="keyword">double</span>)ansMin, ((ansSum / (<span class="keyword">double</span>)n) * <span class="number">100.0</span>+<span class="number">0.5</span>)/<span class="number">100.0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/16/Floyd%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/16/Floyd%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">Floyd原理分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-16 17:23:17" itemprop="dateCreated datePublished" datetime="2019-11-16T17:23:17+08:00">2019-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">算法相关</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Floyd（弗洛伊德算法）"><a href="#Floyd（弗洛伊德算法）" class="headerlink" title="Floyd（弗洛伊德算法）"></a>Floyd（弗洛伊德算法）</h2><h3 id="Floyd算法原理"><a href="#Floyd算法原理" class="headerlink" title="Floyd算法原理"></a>Floyd算法原理</h3><p>Floyd算法是用来解决全源最短路问题的算法，其原理支持便是如果给定的图中存在一个顶点k，使得以k点作为中介点时可以使图中另外两个顶点，顶点i与顶点j之间的最短距离缩短。假设以d[i][j]作为当前顶点i与顶点j之间的最短距离，则上述原理可以表示为</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(d[i][k] + d[k][i] &lt; d[i][j]) &#123;</span><br><span class="line">	d[i][j] = d[i][k] + d[k][i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Floyd过程模拟"><a href="#Floyd过程模拟" class="headerlink" title="Floyd过程模拟"></a>Floyd过程模拟</h3><p>以下图为例，进行一次Floyd运行过程的模拟。</p>
<p><img src="/2019/11/16/Floyd%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/floyd1-1.svg" alt="img"></p>
<h4 id="初始状态"><a href="#初始状态" class="headerlink" title="初始状态"></a>初始状态</h4><p>初始将所有点之间的最短距离都记为无穷大，每个点到其本身距离为0，在输入时记录更新路径两端的点的最短距离。</p>
<p>初始最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>∞</td>
<td>1</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>3</td>
<td>10</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>∞</td>
<td>5</td>
<td>∞</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>∞</td>
<td>∞</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第一个k（k为A点）"><a href="#第一个k（k为A点）" class="headerlink" title="第一个k（k为A点）"></a>第一个k（k为A点）</h4><p>遍历所有顶点，查看以A点为中介时是否存在任意两点之间的最短距离可以被优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C-&gt;B当前为无穷大 C-&gt;A当前为4 A-&gt;B当前为2 C-&gt;B被A优化为4+2&#x3D;6</span><br><span class="line">C-&gt;D当前为无穷大 C-&gt;A当前为4 A-&gt;D当前为1 C-&gt;D被A优化为4+1&#x3D;5</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>∞</td>
<td>1</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>3</td>
<td>10</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td><code>6</code></td>
<td>0</td>
<td><code>5</code></td>
<td>∞</td>
<td>5</td>
<td>∞</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>∞</td>
<td>∞</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第二个k（k为B点）"><a href="#第二个k（k为B点）" class="headerlink" title="第二个k（k为B点）"></a>第二个k（k为B点）</h4><p>遍历所有顶点，查看以B点为中介时是否存在任意两点之间的最短距离可以被优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A-&gt;E当前为无穷大 A-&gt;B当前为2 B-&gt;E当前为10 A-&gt;E被B优化为2+10&#x3D;12</span><br><span class="line">C-&gt;E当前为无穷大 C-&gt;B当前为6 B-&gt;E当前为10 C-&gt;E被B优化为6+10&#x3D;16</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>∞</td>
<td>1</td>
<td><code>12</code></td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>3</td>
<td>10</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td><code>16</code></td>
<td>5</td>
<td>∞</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>∞</td>
<td>∞</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第三个k（k为C点）"><a href="#第三个k（k为C点）" class="headerlink" title="第三个k（k为C点）"></a>第三个k（k为C点）</h4><p>遍历所有顶点，查看以C点为中介时是否存在任意两点之间的最短距离可以被优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D-&gt;A当前为无穷大 D-&gt;C当前为2 C-&gt;A当前为4 D-&gt;A被C优化为2+4&#x3D;6</span><br><span class="line">D-&gt;B当前为无穷大 D-&gt;C当前为2 C-&gt;B当前为6 D-&gt;B被C优化为2+6&#x3D;8</span><br><span class="line">D-&gt;F当前为8 D-&gt;C当前为2 C-&gt;F当前为5 D-&gt;F被C优化为2+5&#x3D;7</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>∞</td>
<td>1</td>
<td>12</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>3</td>
<td>10</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>16</td>
<td>5</td>
<td>∞</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td><code>6</code></td>
<td><code>8</code></td>
<td>2</td>
<td>0</td>
<td>2</td>
<td><code>7</code></td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第四个k（k为D点）"><a href="#第四个k（k为D点）" class="headerlink" title="第四个k（k为D点）"></a>第四个k（k为D点）</h4><p>遍历所有顶点，查看以D点为中介时是否存在任意两点之间的最短距离可以被优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">A-&gt;C当前为无穷大 A-&gt;D当前为1 D-&gt;C当前为2 A-&gt;C被D优化为1+2&#x3D;3</span><br><span class="line">A-&gt;E当前为12 A-&gt;D当前为1 D-&gt;E当前为2 A-&gt;E被D优化为1+2&#x3D;3</span><br><span class="line">A-&gt;F当前为无穷大 A-&gt;D当前为1 D-&gt;F当前为7 A-&gt;F被D优化为1+7&#x3D;8</span><br><span class="line">A-&gt;G当前为无穷大 A-&gt;D当前为1 D-&gt;G当前为4 A-&gt;G被D优化为1+4&#x3D;5</span><br><span class="line">B-&gt;A当前为无穷大 B-&gt;D当前为3 D-&gt;A当前为6 B-&gt;A被D优化为3+6&#x3D;9</span><br><span class="line">B-&gt;C当前为无穷大 B-&gt;D当前为3 D-&gt;C当前为2 B-&gt;C被D优化为3+2&#x3D;5</span><br><span class="line">B-&gt;E当前为10 B-&gt;D当前为3 D-&gt;E当前为2 B-&gt;E被D优化为3+2&#x3D;5</span><br><span class="line">B-&gt;F当前为无穷大 B-&gt;D当前为3 D-&gt;F当前为7 B-&gt;F被D优化为3+7&#x3D;10</span><br><span class="line">B-&gt;G当前为无穷大 B-&gt;D当前为3 D-&gt;G当前为4 B-&gt;G被D优化为3+4&#x3D;7</span><br><span class="line">C-&gt;E当前为16 C-&gt;D当前为5 D-&gt;E当前为2 C-&gt;E被D优化为2+5&#x3D;7</span><br><span class="line">C-&gt;G当前为无穷大 C-&gt;D当前为5 D-&gt;G当前为4 C-&gt;G被D优化为5+4&#x3D;9</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td><code>3</code></td>
<td>1</td>
<td><code>3</code></td>
<td><code>8</code></td>
<td><code>5</code></td>
</tr>
<tr>
<td><strong>B</strong></td>
<td><code>9</code></td>
<td>0</td>
<td><code>5</code></td>
<td>3</td>
<td><code>5</code></td>
<td><code>10</code></td>
<td><code>7</code></td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td><code>7</code></td>
<td>5</td>
<td><code>9</code></td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>7</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第五个k（k为E点）"><a href="#第五个k（k为E点）" class="headerlink" title="第五个k（k为E点）"></a>第五个k（k为E点）</h4><p>遍历所有顶点，查看以E点为中介时是否存在任意两点之间的最短距离可以被优化。</p>
<p>找不到可被优化的点。</p>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>9</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>7</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第六个k（k为F点）"><a href="#第六个k（k为F点）" class="headerlink" title="第六个k（k为F点）"></a>第六个k（k为F点）</h4><p>遍历所有顶点，查看以F点为中介时是否存在任意两点之间的最短距离可以被优化。</p>
<p>找不到可被优化的点。</p>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>9</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>7</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第七个k（k为G点）"><a href="#第七个k（k为G点）" class="headerlink" title="第七个k（k为G点）"></a>第七个k（k为G点）</h4><p>遍历所有顶点，查看以G点为中介时是否存在任意两点之间的最短距离可以被优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A-&gt;F当前为8 A-&gt;G当前为5 G-&gt;F当前为1 A-&gt;F被G优化为5+1&#x3D;6</span><br><span class="line">B-&gt;F当前为10 B-&gt;G当前为7 G-&gt;F当前为1 B-&gt;F被G优化为7+1&#x3D;8</span><br><span class="line">D-&gt;F当前为7 D-&gt;G当前为4 G-&gt;F当前为1 D-&gt;F被G优化为4+1&#x3D;5</span><br><span class="line">E-&gt;F当前为无穷大 E-&gt;G当前为6 G-&gt;F当前为1 E-&gt;F被G优化为6+1&#x3D;7</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td><code>6</code></td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>9</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td><code>8</code></td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td><code>5</code></td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td><code>7</code></td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="最终结果"><a href="#最终结果" class="headerlink" title="最终结果"></a>最终结果</h4><p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>6</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>9</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>8</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>5</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>7</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e6</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> dis[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Floyd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k ++)&#123;    <span class="comment">//存在顶点k可以使得顶点i到顶点j的最小距离缩短</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j ++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(dis[i][k] != INF &amp;&amp; dis[k][j] != INF &amp;&amp; dis[i][k] + dis[k][j] &lt; dis[i][j])&#123;</span><br><span class="line">                    dis[i][j] = dis[i][k] + dis[k][j];</span><br><span class="line">                   <span class="comment">// printf("%c优化%c-&gt;%c:%7d\n",'A' + k ,'A'+i, 'A'+j,dis[i][j]);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 输出每次优化的数据</span></span><br><span class="line"><span class="comment">        for(int i = 0; i &lt; n; i ++)&#123;</span></span><br><span class="line"><span class="comment">            for( int j = 0; j &lt; n; j ++)&#123;</span></span><br><span class="line"><span class="comment">                printf("%c-&gt;%c:%7d ", 'A'+i, 'A'+j,dis[i][j]);</span></span><br><span class="line"><span class="comment">                // cout &lt;&lt; dis[i][j] &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            cout &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        cout &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    for(int i = 0; i &lt; n; i ++)&#123;    // 错误写法</span></span><br><span class="line"><span class="comment">        for(int j = 0; j &lt; n; j ++)&#123;</span></span><br><span class="line"><span class="comment">            for(int k = 0; k &lt; n; k ++)&#123;</span></span><br><span class="line"><span class="comment">                if(dis[i][k] != INF &amp;&amp; dis[k][j] != INF &amp;&amp; dis[i][k] + dis[k][j] &lt; dis[i][j])&#123;</span></span><br><span class="line"><span class="comment">                    dis[i][j] = dis[i][k] + dis[k][j];</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fill(dis[<span class="number">0</span>], dis[<span class="number">0</span>] + MAXN * MAXN, INF);</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入顶点数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边数"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i ++)&#123;</span><br><span class="line">        dis[i][i] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边 (端点1 端点2 权值):"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">int</span> u, v, w;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; w;</span><br><span class="line">        dis[u][v] = w;</span><br><span class="line">        <span class="comment">//dis[v][u] = dis;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = m; i &lt; n; i ++)&#123;</span><br><span class="line">        dis[i][i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"初始状态："</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j ++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%c-&gt;%c:%7d "</span>, <span class="string">'A'</span>+i, <span class="string">'A'</span>+j,dis[i][j]);</span><br><span class="line">            <span class="comment">// cout &lt;&lt; dis[i][j] &lt;&lt; " ";</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    Floyd();</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"最终状态："</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j ++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%c-&gt;%c:%7d "</span>, <span class="string">'A'</span>+i, <span class="string">'A'</span>+j,dis[i][j]);</span><br><span class="line">            <span class="comment">// cout &lt;&lt; dis[i][j] &lt;&lt; " ";</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h3><p>对于Floyd算法来说，最外层循环的k不能放到内层，如果将k放到内层会导致最终结果出错，这是因为如果先对被优化的点进行遍历的话，当其遍历过去后相当于已经固定之后再也无法优化。</p>
<p>例如，如果当前有一条路径i-&gt;u-&gt;v-&gt;j若u &gt; i 在遍历到u时出现了点k可以将u-&gt;v的距离缩短，但这时却无法重新对i-&gt;j进行优化，这就导致了错误。</p>
<h3 id="错误模拟"><a href="#错误模拟" class="headerlink" title="错误模拟"></a>错误模拟</h3><p>以下图为例，进行一次Floyd错误运行的模拟。</p>
<p><img src="/2019/11/16/Floyd%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/floyd1-1.svg" alt="img"></p>
<h4 id="初始状态-1"><a href="#初始状态-1" class="headerlink" title="初始状态"></a>初始状态</h4><p>初始将所有点之间的最短距离都记为无穷大，每个点到其本身距离为0，在输入时记录更新路径两端的点的最短距离。</p>
<p>初始最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>∞</td>
<td>1</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>3</td>
<td>10</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>∞</td>
<td>5</td>
<td>∞</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>∞</td>
<td>∞</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第一个i（i为A点）"><a href="#第一个i（i为A点）" class="headerlink" title="第一个i（i为A点）"></a>第一个i（i为A点）</h4><p>遍历所有顶点，查看以A点为起点时是否存在A到任意其他一点之间的最短距离可以被另一点优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A-&gt;C当前为无穷大 A-&gt;D当前为1 D-&gt;C当前为2 A-&gt;C被D优化为1+2&#x3D;3</span><br><span class="line">A-&gt;E当前为无穷大 A-&gt;B当前为2 B-&gt;E当前为10 A-&gt;E被B优化为2+10&#x3D;12</span><br><span class="line">A-&gt;E当前为12 A-&gt;D当前为1 D-&gt;E当前为2 A-&gt;E被D优化为1+2&#x3D;3</span><br><span class="line">A-&gt;F当前为无穷大 A-&gt;C当前为3 C-&gt;F当前为5 A-&gt;F被C优化为3+5&#x3D;8</span><br><span class="line">A-&gt;G当前为无穷大 A-&gt;D当前为1 D-&gt;G当前为4 A-&gt;G被C优化为1+4&#x3D;5</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td><code>3</code></td>
<td>1</td>
<td><code>3</code></td>
<td><code>8</code></td>
<td><code>5</code></td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>3</td>
<td>10</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>∞</td>
<td>5</td>
<td>∞</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>∞</td>
<td>∞</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第二个i（i为B点）"><a href="#第二个i（i为B点）" class="headerlink" title="第二个i（i为B点）"></a>第二个i（i为B点）</h4><p>遍历所有顶点，查看以B点为起点时是否存在B到任意其他一点之间的最短距离可以被另一点优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">B-&gt;C当前为无穷大 B-&gt;D当前为3 D-&gt;C当前为2 B-&gt;C被D优化为3+2&#x3D;5</span><br><span class="line">B-&gt;E当前为10 B-&gt;D当前为3 D-&gt;E当前为2 B-&gt;E被D优化为3+2&#x3D;5</span><br><span class="line">B-&gt;F当前为无穷大 B-&gt;C当前为5 C-&gt;F当前为5 B-&gt;F被C优化为5+5&#x3D;10</span><br><span class="line">B-&gt;G当前为无穷大 B-&gt;D当前为3 D-&gt;G当前为4 B-&gt;G被D优化为3+4&#x3D;7</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td><code>5</code></td>
<td>3</td>
<td><code>5</code></td>
<td><code>10</code></td>
<td><code>7</code></td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>∞</td>
<td>5</td>
<td>∞</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>∞</td>
<td>∞</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第三个i（i为C点）"><a href="#第三个i（i为C点）" class="headerlink" title="第三个i（i为C点）"></a>第三个i（i为C点）</h4><p>遍历所有顶点，查看以C点为起点时是否存在C到任意其他一点之间的最短距离可以被另一点优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C-&gt;B当前为无穷大 C-&gt;A当前为4 A-&gt;B当前为2 C-&gt;B被A优化为4+2&#x3D;6</span><br><span class="line">C-&gt;D当前为无穷大 C-&gt;A当前为4 A-&gt;D当前为1 C-&gt;D被A优化为4+1&#x3D;5</span><br><span class="line">C-&gt;E当前为无穷大 C-&gt;A当前为4 A-&gt;E当前为3 C-&gt;E被A优化为4+3&#x3D;7</span><br><span class="line">C-&gt;G当前为无穷大 C-&gt;A当前为4 A-&gt;G当前为5 C-&gt;G被A优化为4+5&#x3D;9</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td><code>6</code></td>
<td>0</td>
<td><code>5</code></td>
<td><code>7</code></td>
<td>5</td>
<td><code>9</code></td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>∞</td>
<td>∞</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第四个i（i为D点）"><a href="#第四个i（i为D点）" class="headerlink" title="第四个i（i为D点）"></a>第四个i（i为D点）</h4><p>遍历所有顶点，查看以D点为起点时是否存在D到任意其他一点之间的最短距离可以被另一点优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D-&gt;A当前为无穷大 D-&gt;C当前为2 C-&gt;A当前为4 D-&gt;A被C优化为2+4&#x3D;6</span><br><span class="line">D-&gt;B当前为无穷大 D-&gt;A当前为6 A-&gt;B当前为2 D-&gt;B被A优化为6+2&#x3D;8</span><br><span class="line">D-&gt;F当前为8 D-&gt;C当前为2 C-&gt;F当前为5 D-&gt;F被C优化为2+5&#x3D;7</span><br><span class="line">D-&gt;F当前为7 D-&gt;G当前为4 G-&gt;F当前为1 D-&gt;F被G优化为4+1&#x3D;5</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td><code>6</code></td>
<td><code>8</code></td>
<td>2</td>
<td>0</td>
<td>2</td>
<td><code>5</code></td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第五个i（i为E点）"><a href="#第五个i（i为E点）" class="headerlink" title="第五个i（i为E点）"></a>第五个i（i为E点）</h4><p>遍历所有顶点，查看以E点为起点时是否存在E到任意其他一点之间的最短距离可以被另一点优化。</p>
<p>可以找到如下可被优化的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E-&gt;F当前为无穷大 E-&gt;G当前为6 G-&gt;F当前为1 E-&gt;F被G优化为6+1&#x3D;7</span><br></pre></td></tr></table></figure>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>5</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td><code>7</code></td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第六个i（i为F点）"><a href="#第六个i（i为F点）" class="headerlink" title="第六个i（i为F点）"></a>第六个i（i为F点）</h4><p>遍历所有顶点，查看以F点为起点时是否存在F到任意其他一点之间的最短距离可以被另一点优化。</p>
<p>没有可优化的情况。</p>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>5</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>7</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第七个i（i为G点）"><a href="#第七个i（i为G点）" class="headerlink" title="第七个i（i为G点）"></a>第七个i（i为G点）</h4><p>遍历所有顶点，查看以G点为起点时是否存在G到任意其他一点之间的最短距离可以被另一点优化。</p>
<p>没有可优化的情况。</p>
<p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>5</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>7</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h4 id="错误结果"><a href="#错误结果" class="headerlink" title="错误结果"></a>错误结果</h4><p>当前最短距离表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>B</strong></td>
<td>∞</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr>
<td><strong>C</strong></td>
<td>4</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>7</td>
<td>5</td>
<td>9</td>
</tr>
<tr>
<td><strong>D</strong></td>
<td>6</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>5</td>
<td>4</td>
</tr>
<tr>
<td><strong>E</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>7</td>
<td>6</td>
</tr>
<tr>
<td><strong>F</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>∞</td>
</tr>
<tr>
<td><strong>G</strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p>明显与上方正确答案存在很大差异</p>
<p>所以对中介点k的遍历一定要放在最外层。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">SPFA原理分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-13 08:13:28" itemprop="dateCreated datePublished" datetime="2019-11-13T08:13:28+08:00">2019-11-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">算法相关</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SPFA原理分析"><a href="#SPFA原理分析" class="headerlink" title="SPFA原理分析"></a>SPFA原理分析</h2><h3 id="贝尔曼-福特算法时间复杂度"><a href="#贝尔曼-福特算法时间复杂度" class="headerlink" title="贝尔曼 福特算法时间复杂度"></a>贝尔曼 福特算法时间复杂度</h3><p>针对N个顶点E条边的连通图，由于Bellman Ford算法需要对所有的边遍历N-1次后再添加一次额外的遍历(<a href="https://www.suvvm.work/2019/11/12/Bellman-Ford原理分析/">详见</a>)，其时间复杂度为 $ O(N\times E)$ 。这个复杂度依旧不尽人意，现在要对其进行优化，之前针对贝尔曼 福特算法的分析中指出，如果最短路存在，松弛操作的次数不会超过N-1，正因如此，每个点被优化的次数也不会超过N-1，且只有当某个顶点u到源点的最短距离发生改变，它所发出的边所指向的另外一点v到源点的最短路才有可能会发生改变。</p>
<h3 id="进行优化"><a href="#进行优化" class="headerlink" title="进行优化"></a>进行优化</h3><p>以上方思想为指导进行优化，初始将源点到所有顶点最短路距离视为无穷大，之后维护一个队列，每次将队首的顶点u取出，对从u出发的所有边进行遍历，如果u可以使边另一端的顶点v到达源点的最短距离缩短，则进行优化操作，如果当前v不在队列中则将v入队，这样一旦队列为空时证明所有的优化已经完成，便可以成功获得源点到所有点的最短路长度，而一旦某个点被优化的次数超过N-1则说明给出的图中有从源点可达的负环。</p>
<h3 id="模拟SPFA运行过程"><a href="#模拟SPFA运行过程" class="headerlink" title="模拟SPFA运行过程"></a>模拟SPFA运行过程</h3><p>以下图为例，进行一次SPFA运行过程的模拟。</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-1.svg" alt="img"></p>
<p>以A为起点，依旧用其他最短路算法一样，将初始状态的，源点到所有点之间的最短距离视为无穷大。</p>
<h4 id="优化源点"><a href="#优化源点" class="headerlink" title="优化源点"></a>优化源点</h4><p>记录源点到其本身的距离为0，并将其入队。</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-2.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第一次优化"><a href="#第一次优化" class="headerlink" title="第一次优化"></a>第一次优化</h4><p>将队首的元素A出队，遍历所有以A为起点的边</p>
<p>以A为起点的边有权值为2的$A\rightarrow B$与权值为3的$A\rightarrow C$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(∞)	将B点到源点的最短距离由无穷大优化为0+2&#x3D;2</span><br><span class="line">边A(0)	3	C(∞)	将C点到源点的最短距离由无穷大优化为0+2&#x3D;3</span><br></pre></td></tr></table></figure>
<p>将被优化的B点和C点入队</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-3.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">2</td>
<td style="text-align:left">3</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第二次优化"><a href="#第二次优化" class="headerlink" title="第二次优化"></a>第二次优化</h4><p>将队首的元素B出队，遍历所有以B为起点的边</p>
<p>以B为起点的边有权值为6的$B\rightarrow E$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">边B(2)	6	E(∞)	将E点到源点的最短距离由无穷大优化为2+6&#x3D;8</span><br></pre></td></tr></table></figure>
<p>将被优化的E点入队</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-4.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>C</th>
<th>E</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>8</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">2</td>
<td style="text-align:left">3</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">8</td>
<td style="text-align:left">∞</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第三次优化"><a href="#第三次优化" class="headerlink" title="第三次优化"></a>第三次优化</h4><p>将队首的元素C出队，遍历所有以C为起点的边</p>
<p>以B为起点的边有权值为-2的$C\rightarrow B$与权值为5的$C\rightarrow E$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">边C(3)	-2	B(2)	将B点到源点的最短距离由无穷大优化为3-2&#x3D;1</span><br><span class="line">边C(3)	5	E(8)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p>将被优化的B点入队</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-5.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>E</th>
<th>B</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">8</td>
<td style="text-align:left">∞</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第四次优化"><a href="#第四次优化" class="headerlink" title="第四次优化"></a>第四次优化</h4><p>将队首的元素E出队，遍历所有以E为起点的边</p>
<p>以E为起点的边有权值为-5的$E\rightarrow D$与权值为8的$E\rightarrow F$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">边E(8)	-5	D(∞)	将D点到源点的最短距离由无穷大优化为8-5&#x3D;3</span><br><span class="line">边E(8)	8	F(∞)	将F点到源点的最短距离由无穷大优化为8+8&#x3D;16</span><br></pre></td></tr></table></figure>
<p>将被优化的点D点F入队</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-6.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>B</th>
<th>D</th>
<th>F</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>3</td>
<td>16</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">3</td>
<td style="text-align:left">8</td>
<td style="text-align:left">16</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第五次优化"><a href="#第五次优化" class="headerlink" title="第五次优化"></a>第五次优化</h4><p>将队首的元素B出队，遍历所有以B为起点的边</p>
<p>以B为起点的边有权值为6的$B\rightarrow E$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">边B(1)	4	E(8)	将E点到源点的最短距离由8优化为1+6&#x3D;7</span><br></pre></td></tr></table></figure>
<p>将被优化的E点入队</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-7.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>D</th>
<th>F</th>
<th>E</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>16</td>
<td>7</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">3</td>
<td style="text-align:left">7</td>
<td style="text-align:left">16</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第六次优化"><a href="#第六次优化" class="headerlink" title="第六次优化"></a>第六次优化</h4><p>将队首的元素D出队，遍历所有以D为起点的边</p>
<p>以D为起点的边有权值为4的$D\rightarrow B$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">边D(3)	6	B(1)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p>没有要入队的点</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-8.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>F</th>
<th>E</th>
</tr>
</thead>
<tbody>
<tr>
<td>16</td>
<td>7</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">3</td>
<td style="text-align:left">7</td>
<td style="text-align:left">16</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第七次优化"><a href="#第七次优化" class="headerlink" title="第七次优化"></a>第七次优化</h4><p>将队首的元素F出队，遍历所有以F为起点的边</p>
<p>以F为起点的边有权值为3的$F\rightarrow C$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">边F(16)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p>没有要入队的点</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-9.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>E</th>
</tr>
</thead>
<tbody>
<tr>
<td>7</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">3</td>
<td style="text-align:left">7</td>
<td style="text-align:left">16</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第八次优化"><a href="#第八次优化" class="headerlink" title="第八次优化"></a>第八次优化</h4><p>将队首的元素E出队，遍历所有以E为起点的边</p>
<p>以E为起点的边有权值为-5的$E\rightarrow D$与权值为8的$E\rightarrow F$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">边E(7)	-5	D(3)	将D点到源点的最短距离由无穷大优化为7-5&#x3D;2</span><br><span class="line">边E(7)	8	F(16)	将F点到源点的最短距离由无穷大优化为7+8&#x3D;15</span><br></pre></td></tr></table></figure>
<p>将被优化的点D点F入队</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-10.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>D</th>
<th>F</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>15</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">15</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第九次优化"><a href="#第九次优化" class="headerlink" title="第九次优化"></a>第九次优化</h4><p>将队首的元素D出队，遍历所有以D为起点的边</p>
<p>以D为起点的边有权值为4的$D\rightarrow B$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">边D(2)	4	B(1)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p>没有要入队的点</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-11.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>F</th>
</tr>
</thead>
<tbody>
<tr>
<td>15</td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">15</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第十次优化"><a href="#第十次优化" class="headerlink" title="第十次优化"></a>第十次优化</h4><p>将队首的元素F出队，遍历所有以F为起点的边</p>
<p>以F为起点的边有权值为3的$F\rightarrow C$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">边F(15)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p>没有要入队的点</p>
<p><img src="/2019/11/13/SPFA%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/spfa1-12.svg" alt="img"></p>
<p>此时队列中的点</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>没啦！</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">15</td>
</tr>
</tbody>
</table>
</div>
<p>到此为止所有的优化都完成了，虽然比较原生的Bellman-Ford要多了五次优化，但SPFA的每次优化并不需要遍历所有边，只需要遍历以出队点为源点的边即可，这就将SPFA的时间复杂度大大降低，降为了$O(M\times E)$而且通常情况下M不会超过2，这使得SPFA再处理没有负环的情况下的速度往往要优于堆优化的dijkstra，但是不要太寄希望于SPFA，都知道它快，所以有很多题目都会有专门的一组数据来卡SPFA（具体请随便找一个搜索引擎搜索卡SPFA），而且SPFA在有负环时时间复杂度会退化为$O(N\times E)$ 我比较懒，就不模拟负环运行了。</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e6</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, dis;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;Node&gt; Adj[MAXN];</span><br><span class="line"><span class="keyword">int</span> num[MAXN];</span><br><span class="line"><span class="keyword">bool</span> inq[MAXN];</span><br><span class="line"><span class="keyword">int</span> d[MAXN];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SPFA</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    fill(d, d + MAXN, INF); <span class="comment">//初始化起点到所有点的最短路长度为无穷大</span></span><br><span class="line">    <span class="built_in">queue</span>&lt;Node&gt; Q;</span><br><span class="line">    d[s] = <span class="number">0</span>;   <span class="comment">//起点至本身的距离为0</span></span><br><span class="line">    Q.push(Node&#123;s, <span class="number">0</span>&#125;); <span class="comment">//这里队列中Node.v为当前点 Node.dis为当前点至起点的距离</span></span><br><span class="line">    inq[s] = <span class="literal">true</span>;  <span class="comment">//将s标记为已入队</span></span><br><span class="line">    num[s]++;   <span class="comment">//s入队次数加一</span></span><br><span class="line">    <span class="keyword">while</span>(!Q.empty())&#123;</span><br><span class="line">        Node f = Q.front();   <span class="comment">//获取队首元素</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" 出队点："</span> &lt;&lt; f.v;</span><br><span class="line">        Q.pop();    <span class="comment">//出队</span></span><br><span class="line">        inq[f.v] = <span class="literal">false</span>; <span class="comment">//将队首对应的点标记为未入队</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : Adj[f.v])&#123; <span class="comment">//遍历所有该点的相邻点</span></span><br><span class="line">            <span class="keyword">int</span> v = i.v;</span><br><span class="line">            <span class="keyword">int</span> dis = i.dis;</span><br><span class="line">            <span class="keyword">if</span>(d[f.v] + i.dis &lt; d[i.v])&#123;    <span class="comment">//判断是否可以优化</span></span><br><span class="line">                d[i.v] = d[f.v] + i.dis;</span><br><span class="line">                <span class="keyword">if</span>(!inq[i.v])&#123;  <span class="comment">//优化并入队</span></span><br><span class="line">                    Q.push(Node&#123;i.v, d[i.v]&#125;);</span><br><span class="line">                    inq[i.v] = <span class="literal">true</span>;</span><br><span class="line">                    num[i.v] ++;</span><br><span class="line">                    <span class="keyword">if</span>(num[v] &gt;= n) <span class="comment">//入队次数超过n-1则有负环</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入顶点数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边数"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i ++)&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边 (端点1 端点2 权值):"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">int</span> u, v, dis;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; dis;</span><br><span class="line">        Adj[u].push_back(Node&#123;v, dis&#125;);</span><br><span class="line">        <span class="comment">//Adj[v].push_back(Node&#123;u, dis&#125;);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> s;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入起点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="keyword">int</span> e;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入终点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; e;</span><br><span class="line">    <span class="keyword">if</span>(SPFA(s))&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"起点到终点最短路长度:"</span> &lt;&lt; d[e] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" : "</span> &lt;&lt; d[i] &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"最短路不存在"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">Bellman Ford原理分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-12 19:11:56" itemprop="dateCreated datePublished" datetime="2019-11-12T19:11:56+08:00">2019-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">算法相关</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Bellman-Ford（贝尔曼-福特算法）"><a href="#Bellman-Ford（贝尔曼-福特算法）" class="headerlink" title="Bellman Ford（贝尔曼 福特算法）"></a>Bellman Ford（贝尔曼 福特算法）</h2><p>Dijkstra算法可以很好的解决无负权图的最短路问题，但是一旦遇到负权，这个负权就像在迷宫游戏中，走每一条路都会消耗体力，但是某些道路上有宝箱，宝箱里可以开出美利坚大香蕉食用可以恢复体力，dijkstra会使你只顾着眼前消耗体力最少的道路而忽视了之后的美利坚大香蕉（<a href="https://www.suvvm.work/2019/11/05/Dijkstra原理分析/">具体分析</a>），这时便需要设计另一个算法去代替它，如Bellman Ford。</p>
<p>如果一个有N个顶点的连通图中有最短路存在，那么这条最短路径上的顶点个数肯定不会超过N个，当源点被确定时，我们可以根据源点建立一条最短路径树，具体以下图为例，假设A为源点。</p>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf1-1.svg" alt="img"></p>
<p>最短路径树</p>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf1-2.svg" alt="img"></p>
<p>最短路径树的层数一定不会超过N。</p>
<p>Bellman Ford算法与dijkstra类似，也需要设置一个数组d用来存放源点到各个顶点的最短距离。</p>
<p>每次遍历图中所有边，根据边的权值进行松弛操作（对于每条边$u \rightarrow v $ 如果以u为中介点可以使v到源点的距离更短，就用u到源点的距离与当前边权去优化v到源点的距离）。</p>
<p>初始状态下源点已知且到其本身的距离为0，即最短路径树的第一层结点已被确定，由第二层开始之后每次执行上述的松弛操作都可以确定一层的结点，由于最短路径树的层数不会超过N，所以确定所有点到源点的最短路长度所需要进行松弛操作的次数不会超过N-1。</p>
<p>同dijkstra一样，初始将起点到所有点的最短路长度视为无穷大。</p>
<p>记录一下图中的所有边</p>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf2-1.svg" alt="img"></p>
<h3 id="确定源点"><a href="#确定源点" class="headerlink" title="确定源点"></a>确定源点</h3><p>这里以A为源点，源点到其本身的距离为0。</p>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf2-2.svg" alt="img"></p>
<p> 当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
</tr>
</tbody>
</table>
</div>
<p>一共6个点，之后进行6-1=5次松弛操作。</p>
<h3 id="第一次松弛"><a href="#第一次松弛" class="headerlink" title="第一次松弛"></a>第一次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(∞)	将B点到源点的最短距离由无穷大优化为0+2&#x3D;2</span><br><span class="line">边A(0)	3	C(∞)	将C点到源点的最短距离由无穷大优化为0+2&#x3D;3</span><br><span class="line">边B(2)	6	E(∞)	将E点到源点的最短距离由无穷大优化为2+6&#x3D;8</span><br><span class="line">边C(3)	-2	B(2)	将B点到源点的最短距离由2优化为3-2&#x3D;1</span><br><span class="line">边C(3)	5	E(8)	并不能进行优化</span><br><span class="line">边D(∞)	4	B(1)	并不能进行优化</span><br><span class="line">边E(8)	-5	D(∞)	将D点到源点的最短距离由无穷大优化为8-5&#x3D;3</span><br><span class="line">边E(8)	8	F(∞)	将F点到源点的最短距离由无穷大优化为8+8&#x3D;16</span><br><span class="line">边F(16)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf2-3.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">3</td>
<td style="text-align:left">8</td>
<td style="text-align:left">∞</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第二次松弛"><a href="#第二次松弛" class="headerlink" title="第二次松弛"></a>第二次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(1)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(1)	6	E(8)	将E点到源点的最短距离由8优化为1+6&#x3D;7</span><br><span class="line">边C(3)	-2	B(1)	并不能进行优化</span><br><span class="line">边C(3)	5	E(7)	并不能进行优化</span><br><span class="line">边D(3)	4	B(1)	并不能进行优化</span><br><span class="line">边E(7)	-5	D(3)	将D点到源点的最短距离由3优化为7-5&#x3D;2</span><br><span class="line">边E(7)	8	F(16)	将F点到源点的最短距离由16优化为7+8&#x3D;15</span><br><span class="line">边F(15)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf2-4.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">15</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第三次松弛"><a href="#第三次松弛" class="headerlink" title="第三次松弛"></a>第三次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(1)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(1)	6	E(7)	并不能进行优化</span><br><span class="line">边C(3)	-2	B(1)	并不能进行优化</span><br><span class="line">边C(3)	5	E(7)	并不能进行优化</span><br><span class="line">边D(2)	4	B(1)	并不能进行优化</span><br><span class="line">边E(7)	-5	D(2)	并不能进行优化</span><br><span class="line">边E(7)	8	F(15)	并不能进行优化</span><br><span class="line">边F(15)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf2-4.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">15</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第四次松弛"><a href="#第四次松弛" class="headerlink" title="第四次松弛"></a>第四次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(1)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(1)	6	E(7)	并不能进行优化</span><br><span class="line">边C(3)	-2	B(1)	并不能进行优化</span><br><span class="line">边C(3)	5	E(7)	并不能进行优化</span><br><span class="line">边D(2)	4	B(1)	并不能进行优化</span><br><span class="line">边E(7)	-5	D(2)	并不能进行优化</span><br><span class="line">边E(7)	8	F(15)	并不能进行优化</span><br><span class="line">边F(15)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf2-4.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">15</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第五次松弛"><a href="#第五次松弛" class="headerlink" title="第五次松弛"></a>第五次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(1)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(1)	6	E(7)	并不能进行优化</span><br><span class="line">边C(3)	-2	B(1)	并不能进行优化</span><br><span class="line">边C(3)	5	E(7)	并不能进行优化</span><br><span class="line">边D(2)	4	B(1)	并不能进行优化</span><br><span class="line">边E(7)	-5	D(2)	并不能进行优化</span><br><span class="line">边E(7)	8	F(15)	并不能进行优化</span><br><span class="line">边F(15)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf2-4.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">15</td>
</tr>
</tbody>
</table>
</div>
<p>到此为止五次松弛操作都已经结束，在对比一下我们之前肉眼观察出来的最短路径树。</p>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf1-2.svg" alt="img"></p>
<p>仿佛没有什么问题，我们成功的获得了最短路径，可喜可贺，Bellman Ford结束了，诸位洗洗睡把。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">6 9</span><br><span class="line">0 1 2</span><br><span class="line">0 2 3</span><br><span class="line">1 4 6</span><br><span class="line">2 1 -2</span><br><span class="line">2 4 5</span><br><span class="line">3 1 4</span><br><span class="line">4 3 -5</span><br><span class="line">4 5 8</span><br><span class="line">5 2 3</span><br><span class="line">0</span><br></pre></td></tr></table></figure></p>
<h1 id="呸！！！"><a href="#呸！！！" class="headerlink" title="呸！！！"></a>呸！！！</h1><h3 id="负环"><a href="#负环" class="headerlink" title="负环"></a>负环</h3><p>负环这个东西很神奇，拿之前迷宫的例子来描述它，就是你可以发现有一条道路与之前的某个点形成了一个环，这个环上有一个或者多个大宝箱，里面有很多美利坚大香蕉，使得走完一次循环后吃美利坚大香蕉所恢复的体力比走路消耗的还多，这样就可以一直走这个环，刷更多的美利坚大香蕉恢复更多的体力。</p>
<p>我们修改一下上面的图，将D到B的边的边权改为-4，这样就形成了一个B到E到D回到B的一个权值为6-5-4=-3的负环。</p>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf3-1.svg" alt="img"></p>
<p>我们依照之前的算法再次推理一遍。</p>
<h3 id="确定源点-1"><a href="#确定源点-1" class="headerlink" title="确定源点"></a>确定源点</h3><p>以A为源点，源点到其本身的距离为0。</p>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf3-2.svg" alt="img"></p>
<p> 当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
<td style="text-align:left">∞</td>
</tr>
</tbody>
</table>
</div>
<p>一共6个点，之后进行6-1=5次松弛操作。</p>
<h3 id="第一次松弛-1"><a href="#第一次松弛-1" class="headerlink" title="第一次松弛"></a>第一次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(∞)	将B点到源点的最短距离由无穷大优化为0+2&#x3D;2</span><br><span class="line">边A(0)	3	C(∞)	将C点到源点的最短距离由无穷大优化为0+2&#x3D;3</span><br><span class="line">边B(2)	6	E(∞)	将E点到源点的最短距离由无穷大优化为2+6&#x3D;8</span><br><span class="line">边C(3)	-2	B(2)	将B点到源点的最短距离由2优化为3-2&#x3D;1</span><br><span class="line">边C(3)	5	E(8)	并不能进行优化</span><br><span class="line">边D(∞)	-4	B(1)	并不能进行优化</span><br><span class="line">边E(8)	-5	D(∞)	将D点到源点的最短距离由无穷大优化为8-5&#x3D;3</span><br><span class="line">边E(8)	8	F(∞)	将F点到源点的最短距离由无穷大优化为8+8&#x3D;16</span><br><span class="line">边F(16)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf3-3.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">3</td>
<td style="text-align:left">8</td>
<td style="text-align:left">16</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第二次松弛-1"><a href="#第二次松弛-1" class="headerlink" title="第二次松弛"></a>第二次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(1)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(1)	6	E(8)	将E点到源点的最短距离由8优化为1+6&#x3D;7</span><br><span class="line">边C(3)	-2	B(1)	并不能进行优化</span><br><span class="line">边C(3)	5	E(7)	并不能进行优化</span><br><span class="line">边D(3)	-4	B(1)	将B点到源点的最短距离由1优化为3-4&#x3D;-1</span><br><span class="line">边E(7)	-5	D(3)	将D点到源点的最短距离由3优化为7-5&#x3D;2</span><br><span class="line">边E(7)	8	F(16)	将F点到源点的最短距离由16优化为7+8&#x3D;15</span><br><span class="line">边F(15)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf3-4.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">-1</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">15</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第三次松弛-1"><a href="#第三次松弛-1" class="headerlink" title="第三次松弛"></a>第三次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(-1)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(-1)	6	E(7)	将E点到源点的最短距离由7优化为-1+6&#x3D;5</span><br><span class="line">边C(3)	-2	B(-1)	并不能进行优化</span><br><span class="line">边C(3)	5	E(5)	并不能进行优化</span><br><span class="line">边D(2)	-4	B(-1)	将B点到源点的最短距离由-1优化为2-4&#x3D;-2</span><br><span class="line">边E(5)	-5	D(2)	将D点到源点的最短距离由2优化为-5+5&#x3D;0</span><br><span class="line">边E(5)	8	F(15)	将F点到源点的最短距离由15优化为5+8&#x3D;13</span><br><span class="line">边F(13)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf3-5.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">-2</td>
<td style="text-align:left">3</td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
<td style="text-align:left">13</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第四次松弛-1"><a href="#第四次松弛-1" class="headerlink" title="第四次松弛"></a>第四次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(-2)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(-2)	6	E(5)	将E点到源点的最短距离由5优化为-2+6&#x3D;4</span><br><span class="line">边C(3)	-2	B(-2)	并不能进行优化</span><br><span class="line">边C(3)	5	E(4)	并不能进行优化</span><br><span class="line">边D(0)	-4	B(-2)	将B点到源点的最短距离由-2优化为0-4&#x3D;-4</span><br><span class="line">边E(4)	-5	D(0)	将D点到源点的最短距离由0优化为4-5&#x3D;-1</span><br><span class="line">边E(4)	8	F(13)	将F点到源点的最短距离由13优化为4+8&#x3D;12</span><br><span class="line">边F(12)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf3-6.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">-4</td>
<td style="text-align:left">3</td>
<td style="text-align:left">-1</td>
<td style="text-align:left">4</td>
<td style="text-align:left">12</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第五次松弛-1"><a href="#第五次松弛-1" class="headerlink" title="第五次松弛"></a>第五次松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(-4)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(-4)	6	E(4)	将E点到源点的最短距离由4优化为-4+6&#x3D;2</span><br><span class="line">边C(3)	-2	B(-4)	并不能进行优化</span><br><span class="line">边C(3)	5	E(2)	并不能进行优化</span><br><span class="line">边D(-4)	-4	B(1)	将B点到源点的最短距离由-4优化为-4-4&#x3D;-8</span><br><span class="line">边E(2)	-5	D(-1)	将D点到源点的最短距离由-1优化为2-5&#x3D;-3</span><br><span class="line">边E(2)	8	F(12)	将F点到源点的最短距离由12优化为2+8&#x3D;10</span><br><span class="line">边F(10)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf3-7.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">-5</td>
<td style="text-align:left">3</td>
<td style="text-align:left">-3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">10</td>
</tr>
</tbody>
</table>
</div>
<p>到此为止五次松弛操作都已经结束</p>
<p>还能不能继续松弛呢，这里再进行一次额外的松弛操作</p>
<h3 id="额外松弛"><a href="#额外松弛" class="headerlink" title="额外松弛"></a>额外松弛</h3><p>遍历所有边，根据其权值与两端点到源点的距离进行松弛操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">边A(0)	2	B(-5)	并不能进行优化</span><br><span class="line">边A(0)	3	C(3)	并不能进行优化</span><br><span class="line">边B(-5)	6	E(2)	将E点到源点的最短距离由2优化为-5+6&#x3D;1</span><br><span class="line">边C(3)	-2	B(-5)	并不能进行优化</span><br><span class="line">边C(3)	5	E(1)	并不能进行优化</span><br><span class="line">边D(-3)	-4	B(-5)	将B点到源点的最短距离由-5优化为-3-4&#x3D;-7</span><br><span class="line">边E(1)	-5	D(-3)	将D点到源点的最短距离由-3优化为1-5&#x3D;-4</span><br><span class="line">边E(1)	8	F(10)	将F点到源点的最短距离由10优化为1+8&#x3D;9</span><br><span class="line">边F(9)	3	C(3)	并不能进行优化</span><br></pre></td></tr></table></figure>
<p><img src="/2019/11/12/Bellman-Ford%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/bf3-8.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">C</th>
<th style="text-align:left">D</th>
<th style="text-align:left">E</th>
<th style="text-align:left">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">-7</td>
<td style="text-align:left">3</td>
<td style="text-align:left">-4</td>
<td style="text-align:left">1</td>
<td style="text-align:left">9</td>
</tr>
</tbody>
</table>
</div>
<p>果然还可以优化。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">6 9</span><br><span class="line">0 1 2</span><br><span class="line">0 2 3</span><br><span class="line">1 4 6</span><br><span class="line">2 1 -2</span><br><span class="line">2 4 5</span><br><span class="line">3 1 -4</span><br><span class="line">4 3 -5</span><br><span class="line">4 5 8</span><br><span class="line">5 2 3</span><br><span class="line">0</span><br></pre></td></tr></table></figure></p>
<h3 id="负环处理"><a href="#负环处理" class="headerlink" title="负环处理"></a>负环处理</h3><p>如何处理这种有负环的情况呢？当然是不去处理它，同上述步骤一样，我们多进行一次额外松弛，如果额外松弛时已经有优化发送，我们就认为这个图有负环，然后报告主函数即可。</p>
<h3 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e6</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, dis;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;node&gt; Adj[MAXN];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> d[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BF</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    fill(d, d + MAXN, INF);<span class="comment">//初始化起点到所有点的最短路长度为无穷大</span></span><br><span class="line">    d[s] = <span class="number">0</span>;   <span class="comment">//起点至本身的距离为0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i ++)&#123;    <span class="comment">//遍历n - 1遍（一条最短路除去源点最多包含n-1个点，这里可以做优化）</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> u = <span class="number">0</span>; u &lt; n; u ++)&#123;    <span class="comment">//遍历所有顶点</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> j : Adj[u])&#123;   <span class="comment">//找到所有与当前点连通的点</span></span><br><span class="line">                <span class="keyword">if</span>(d[j.v] &gt; d[u] + j.dis)&#123;</span><br><span class="line">                    d[j.v] = d[u] + j.dis;  <span class="comment">//松弛操作</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        for(int i = 0; i &lt; n; i++)&#123;</span></span><br><span class="line"><span class="comment">            cout &lt;&lt; " " &lt;&lt; i &lt;&lt; ":" &lt;&lt; d[i];</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        cout &lt;&lt; endl;*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> u = <span class="number">0</span>; u &lt; n; u ++)&#123;    <span class="comment">//检测负环 如果已经执行上述n-1遍理应成功获取起点至所有点的最短路 若还可以继续松弛则存在负环</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> j : Adj[u])&#123;</span><br><span class="line">            <span class="keyword">if</span>(d[j.v] &gt; d[u] + j.dis)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入顶点数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边数"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i ++)&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边 (端点1 端点2 权值):"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">int</span> u, v, dis;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; dis;</span><br><span class="line">        Adj[u].push_back(node&#123;v, dis&#125;);</span><br><span class="line">        <span class="comment">//Adj[v].push_back(node&#123;u, dis&#125;);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> s;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入起点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="keyword">int</span> e;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入终点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; e;</span><br><span class="line">    <span class="keyword">if</span>(BF(s))&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"最短路长度:"</span> &lt;&lt; d[e] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" : "</span> &lt;&lt; d[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"最短路不存在"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/10/%E7%97%85%E6%AF%92%E7%B9%81%E6%AE%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/10/%E7%97%85%E6%AF%92%E7%B9%81%E6%AE%96/" class="post-title-link" itemprop="url">病毒繁殖</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-10 19:02:02" itemprop="dateCreated datePublished" datetime="2019-11-10T19:02:02+08:00">2019-11-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>【问题描述】  </p>
<p> 　A学校的实验室新研制出了一种十分厉害的病毒。由于这种病毒太难以人工制造了，所以专家们在一开始只做出了一个这样的病毒。 </p>
<p> 　这个病毒被植入了特殊的微型芯片，使其可以具有一些可编程的特殊性能。最重要的一个性能就是，专家们可以自行设定病毒的分裂能力 K，假如现在有x 个病毒，下一个分裂周期将会有 Kx个一模一样的病毒。你作为该实验室的数据分析员，需要统计出在分裂到第N个周期前，一共有多少个病毒单体进行了分裂。一开始时总是只有一个病毒，这个局面算作第一个周期。由于答案可能很大，专家们只需要你告诉他们对给定的P取模后的答案。</p>
<p> 【输入格式】  </p>
<p> 　一行三个整数，依次是K, N, P。</p>
<p> 【输出格式】  </p>
<p> 　一行一个整数，你的答案（对P取模） 。</p>
<p> 【输入样例】  </p>
<p> 【样例1】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5 3 7</span><br></pre></td></tr></table></figure>
<p> 【样例2】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 6 23</span><br></pre></td></tr></table></figure>
<p> 【输出样例】  </p>
<p> 【样例1】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6</span><br></pre></td></tr></table></figure>
<p> 【样例2】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8</span><br></pre></td></tr></table></figure>
<p> 【样例解释】  </p>
<p> 　样例一解释：第一个周期有 1 个病毒，产生了一次分裂。第二个周期有 $1 \times 5=5$ 个病毒， 这五个病毒都会分裂。 所以第三个周期前一共进行了1+5等于 6 次分裂。答案即为6 mod 7 = 6。</p>
<p> 【数据范围】  </p>
<script type="math/tex; mode=display">
 1 < N < 10^{18}\\
 1 < K , P < 2^{31}</script><p>本题就是求$ 1 + K + K^2 + …… + K^N $，对于这个问题可以将其拆分求出$<br> 1 + K + K^2 + …… + K^{ { \frac N2} - 1} $<br>再将其乘以$ K^{\frac N2} $即可得到$ K^{ \frac N2} + K^{ { \frac N2} + 1 } + …… + K^N $，之后将前面两式相加即可得到答案。递归解决即可，幂运算调用快速幂取模即可。<br>（关于快速幂取模可以去本人博客<a href="https://www.suvvm.work/tags/快速幂/">https://www.suvvm.work/tags/快速幂/</a>上去翻）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: power</span></span><br><span class="line"><span class="comment">* Description: 快速幂取模</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">*   @a  底数</span></span><br><span class="line"><span class="comment">*   @b  指数</span></span><br><span class="line"><span class="comment">*   @mod模数</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回幂运算取模后的结果</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">LL <span class="title">power</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> mod)</span></span>&#123;    <span class="comment">//快速幂</span></span><br><span class="line">    LL ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)&#123;</span><br><span class="line">        <span class="keyword">if</span>(b &amp; <span class="number">1</span>)&#123;  <span class="comment">//从b的二进制末位开始判断</span></span><br><span class="line">            ans = ans * a % mod;  <span class="comment">//如果为1更新取模后的答案</span></span><br><span class="line">        &#125;</span><br><span class="line">        a = a * a % mod;    <span class="comment">//更新底数取模</span></span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;    <span class="comment">//b右移一位</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: solve</span></span><br><span class="line"><span class="comment">* Description: 分治解决n个周期前分裂的的细胞单体个数</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">*   @k  分裂能力</span></span><br><span class="line"><span class="comment">*   @n  分裂周期次数</span></span><br><span class="line"><span class="comment">*   @p  模数</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回n个周期前分裂的的细胞单体个数取模后的结果</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">LL <span class="title">solve</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> n, <span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!n)  <span class="comment">// 0次分裂只有一个初始病毒</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(n &amp; <span class="number">1</span>)   <span class="comment">// 奇数次分裂</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span> + power(k, n/<span class="number">2</span> + <span class="number">1</span>, p)) * solve(k, n/<span class="number">2</span>, p) % p;</span><br><span class="line">    <span class="keyword">else</span>    <span class="comment">// 偶数次分裂</span></span><br><span class="line">        <span class="keyword">return</span> (power(k, n/<span class="number">2</span>, p) + (<span class="number">1</span> + power(k, n/<span class="number">2</span> +<span class="number">1</span>, p)) * solve(k, n/<span class="number">2</span> - <span class="number">1</span>, p)) % p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">int</span> k, n, p;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; k &gt;&gt; n &gt;&gt; p;</span><br><span class="line">    n--; <span class="comment">// 以第0次分裂为起始</span></span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span>    <span class="comment">// 第n周期前，没有进行第n周期</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; solve(k, --n, p) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/09/C-%E5%A4%A7%E6%95%B4%E6%95%B0%E8%BF%90%E7%AE%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/09/C-%E5%A4%A7%E6%95%B4%E6%95%B0%E8%BF%90%E7%AE%97/" class="post-title-link" itemprop="url">C++大整数运算</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-09 21:07:58" itemprop="dateCreated datePublished" datetime="2019-11-09T21:07:58+08:00">2019-11-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">算法相关</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>加法运算：以两个数中较大的数的长度为边界进行遍历，由最低位开始按位进行加法运算，将对应位相加并记录进位，在下一位进行相加运算时再加上进位即可。 </p>
<p> 减法运算：同样以两个数中较长的长度为边界进行遍历，按位进行减法运算，不够减则从前一位借位。最终不要忘记消去最高位的0  </p>
<p>倍增（数量级在int内）运算：选择一个数进行遍历，将其每位依次乘另一个数，将产生的结果的个位作为结果，除个位外其他位作为进位。 </p>
<p> 除法（大整数除以普通数）运算：从被除数最高位开始遍历，每一个位与上一位遗留的余数结合后进行除法运算。  比较：优先比较长度，长度相同则由高位向下比较。  </p>
<p>相乘：使用分治思想   假设现有大整数A与大整数B要做乘法运算，如果依照暴力过一切的思想去遍历相乘时间复杂度将变为O(n^2)所以这里使用分治思想。  将长度为n的大数a分为两部分  若n为偶数则可以将a分为长度为$\frac n2$的两段$a_0$与$a_1$  若n为奇数则a0的长度为$\frac {n+1}2$,$a_1$长度为$ \frac n2 $ $a = a_0 \times 10^{\frac n2} + a_1$  则$a \times b$同样可以分为 </p>
<script type="math/tex; mode=display">
a \times b = [a_0 \times 10^{\frac {n_1}2} + a_1] \times [b_0 \times 10^{\frac {n_2}2} + b_1]\\ =  a_0 \times b_0 \times 10^{\frac {n_1}2+\frac {n_2}2}+a_0 \times b_1 \times 10^{\frac {n_1}2} + a_1 \times b_0 \times 10^{\frac {n_2}2}+a_1 \times b_1</script><p>对于新出现的 $a_0 \times b_0 \ \ a_0 \times b_1 \ \ a_1 \times b_0 \ \ a_1\ \times b_1$用相同的方法递归解决即可以。</p>
<p>附上代码</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************************************************************************</span></span><br><span class="line"><span class="comment">* @File: 大面值数据处理</span></span><br><span class="line"><span class="comment">* @Author: suvvm</span></span><br><span class="line"><span class="comment">* @blog: www.suvvm.work</span></span><br><span class="line"><span class="comment">* @github: https://github.com/suvvm</span></span><br><span class="line"><span class="comment">* @email: suvvm@foxmail.com</span></span><br><span class="line"><span class="comment">* @Version: 1.0.0</span></span><br><span class="line"><span class="comment">* @Date: 2019-11-07</span></span><br><span class="line"><span class="comment">* @Description: 2019第2学期算法设计与分析分治实验1第2项</span></span><br><span class="line"><span class="comment">********************************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxz = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* ClassName:BigNum</span></span><br><span class="line"><span class="comment">* Description: 存储大数</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@num	大数具体值（为了方便运算采取低位在前的存储方式）</span></span><br><span class="line"><span class="comment">* 	@len	大数位数</span></span><br><span class="line"><span class="comment">* 	@BigNum	无参构造，将其初始化为0</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BigNum</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> num[maxn];</span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    BigNum()&#123;</span><br><span class="line">        <span class="built_in">memset</span>(num, <span class="number">0</span>, <span class="keyword">sizeof</span>(num));</span><br><span class="line">        len = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName:change</span></span><br><span class="line"><span class="comment">* Description: 将C++ string转换为BigNum</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@temp	传入的字符串</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回转换后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">change</span><span class="params">(<span class="built_in">string</span> temp)</span></span>&#123;</span><br><span class="line">    BigNum a;</span><br><span class="line">    a.len = temp.size();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.len; i++)</span><br><span class="line">        a.num[i] = temp[a.len - i - <span class="number">1</span>] - <span class="string">'0'</span>;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName:compare</span></span><br><span class="line"><span class="comment">* Description: 比较两个BigNum的大小</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	需要比较的参数1</span></span><br><span class="line"><span class="comment">*   @b  需要比较的参数2</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   参数1大于参数2返回(int)1</span></span><br><span class="line"><span class="comment">*   参数2大于参数1返回(int)-1</span></span><br><span class="line"><span class="comment">*   相等返回(int)0</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(BigNum a, BigNum b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.len &gt; b.len)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(a.len &lt; b.len)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = a.len <span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a.num[i] &gt; b.num[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a.num[i] &lt; b.num[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName:add</span></span><br><span class="line"><span class="comment">* Description: 两个BigNum大数相加</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	要进行加法运算的BigNum1</span></span><br><span class="line"><span class="comment">*   @b  要进行加法运算的BigNum2</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回相加后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">add</span><span class="params">(BigNum a, BigNum b)</span></span>&#123;</span><br><span class="line">    BigNum c;</span><br><span class="line">    <span class="keyword">int</span> carry = <span class="number">0</span>;<span class="comment">//进位</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.len || i &lt; b.len; i++)&#123;<span class="comment">//以较长的长度为界限</span></span><br><span class="line">        <span class="keyword">int</span> temp = a.num[i] + b.num[i] + carry;<span class="comment">//两个位置相加后加上进位</span></span><br><span class="line">        c.num[c.len++] = temp % <span class="number">10</span>;</span><br><span class="line">        carry = temp / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(carry != <span class="number">0</span>)</span><br><span class="line">        c.num[c.len++] = carry;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName:sub</span></span><br><span class="line"><span class="comment">* Description: 两个BigNum大数相减</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	被减数</span></span><br><span class="line"><span class="comment">*   @b  减数</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回相减后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">sub</span><span class="params">(BigNum a, BigNum b)</span></span>&#123;</span><br><span class="line">    BigNum c;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.len || i &lt; b.len; i++)&#123;<span class="comment">//较长为界</span></span><br><span class="line">        <span class="keyword">if</span>(a.num[i] &lt; b.num[i])&#123;<span class="comment">//如果不够减</span></span><br><span class="line">            a.num[i + <span class="number">1</span>]--;<span class="comment">//借位</span></span><br><span class="line">            a.num[i] += <span class="number">10</span>;<span class="comment">//加10</span></span><br><span class="line">        &#125;</span><br><span class="line">        c.num[c.len++] = a.num[i] - b.num[i];<span class="comment">//相减结果为当前位结果</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(c.len - <span class="number">1</span> &gt;= <span class="number">1</span> &amp;&amp; c.num[c.len - <span class="number">1</span>] == <span class="number">0</span>)</span><br><span class="line">        c.len--;<span class="comment">//去除最高位的0</span></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: multi</span></span><br><span class="line"><span class="comment">* Description: 将BigNum扩大指定倍数（int）</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	要扩大的BigNum</span></span><br><span class="line"><span class="comment">*   @b  扩大倍数</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回扩大后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">multi</span><span class="params">(BigNum a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    BigNum c;</span><br><span class="line">    <span class="keyword">int</span> carry = <span class="number">0</span>;<span class="comment">//进位</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.len; i++)&#123;<span class="comment">//a每位依次乘b</span></span><br><span class="line">        <span class="keyword">int</span> temp = a.num[i] * b + carry;</span><br><span class="line">        c.num[c.len++] = temp % <span class="number">10</span>;<span class="comment">//temp个位作为该位结果</span></span><br><span class="line">        carry = temp / <span class="number">10</span>;<span class="comment">//temp高位作为进位</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(carry != <span class="number">0</span>)&#123;<span class="comment">//乘法的进位可能不止一位</span></span><br><span class="line">        c.num[c.len++] = carry % <span class="number">10</span>;</span><br><span class="line">        carry /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mod = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> &amp;r = mod;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: divide</span></span><br><span class="line"><span class="comment">* Description: 大数除int内数字</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	被除数</span></span><br><span class="line"><span class="comment">*   @b  除数</span></span><br><span class="line"><span class="comment">*   @r  余数</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回相除后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">divide</span><span class="params">(BigNum a, <span class="keyword">int</span> b, <span class="keyword">int</span> &amp;r)</span></span>&#123;<span class="comment">//r为余数</span></span><br><span class="line">    BigNum c;</span><br><span class="line">    c.len = a.len;<span class="comment">//被除数和商的每一位是一一对应的，所以先令长度相等</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = a.len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;<span class="comment">//从最高位开始</span></span><br><span class="line">        r = r * <span class="number">10</span> + a.num[i];<span class="comment">//每一位和上一位遗留的余数组合</span></span><br><span class="line">        <span class="keyword">if</span>(r &lt; b)</span><br><span class="line">            c.num[i] = <span class="number">0</span>;<span class="comment">//若不够除该位为0</span></span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="comment">//够除</span></span><br><span class="line">            c.num[i] = r / b;<span class="comment">//得到该位的商</span></span><br><span class="line">            r = r % b;<span class="comment">//新的余数</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(c.len - <span class="number">1</span> &gt;= <span class="number">1</span> &amp;&amp; c.num[c.len - <span class="number">1</span>] == <span class="number">0</span>)</span><br><span class="line">        c.len--;<span class="comment">//去除最高位的0</span></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: rmZero</span></span><br><span class="line"><span class="comment">* Description: 在传入大数前方去除0</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	要去除0的大数</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rmZero</span><span class="params">(BigNum &amp;a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(a.len - <span class="number">1</span> &gt;= <span class="number">1</span> &amp;&amp; a.num[a.len - <span class="number">1</span>] == <span class="number">0</span>)</span><br><span class="line">        a.len--;<span class="comment">//去除最高位的0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: addAfterZero</span></span><br><span class="line"><span class="comment">* Description: 在传入大数后方添加0</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	要添加0的大数</span></span><br><span class="line"><span class="comment">*   @l  要添加0的数量</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回添加0后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">addAfterZero</span><span class="params">(BigNum a, <span class="keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp[maxn];</span><br><span class="line">    BigNum res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; i++) &#123;</span><br><span class="line">        tmp[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(res.num, tmp, <span class="keyword">sizeof</span>(tmp));</span><br><span class="line">    <span class="built_in">memcpy</span>(res.num + l, a.num, <span class="keyword">sizeof</span>(a.num));</span><br><span class="line">    res.len = l + a.len;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: addBeforeZero</span></span><br><span class="line"><span class="comment">* Description: 在传入大数前方添加0</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	要添加0的大数</span></span><br><span class="line"><span class="comment">*   @l  要添加0的数量</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回添加0后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">addBeforeZero</span><span class="params">(BigNum a, <span class="keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp[maxn];</span><br><span class="line">    BigNum res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; i++) &#123;</span><br><span class="line">        tmp[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(res.num, a.num, <span class="keyword">sizeof</span>(a.num));</span><br><span class="line">    <span class="built_in">memcpy</span>(res.num + a.len, tmp, <span class="keyword">sizeof</span>(tmp));</span><br><span class="line">    res.len = l + a.len;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: subBigNum</span></span><br><span class="line"><span class="comment">* Description: 大数截取</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	要被截取的大数</span></span><br><span class="line"><span class="comment">*   @bg 开始截取的位置</span></span><br><span class="line"><span class="comment">*   @l  截取的长度</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回截取后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">subBigNum</span><span class="params">(BigNum a, <span class="keyword">int</span> bg, <span class="keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">    BigNum res;</span><br><span class="line">    res.len = l;</span><br><span class="line">    <span class="keyword">int</span> tmp = l<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = a.len - bg; i &gt; a.len - bg - l; i--)&#123;</span><br><span class="line">        <span class="comment">//cout &lt;&lt; "i:" &lt;&lt; i &lt;&lt; " a.num[i]:" &lt;&lt; a.num[i] &lt;&lt; endl;</span></span><br><span class="line">        res.num[tmp--] = a.num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* FunctionName: multi_2</span></span><br><span class="line"><span class="comment">* Description: 大数乘法（分治）</span></span><br><span class="line"><span class="comment">* Parameter:</span></span><br><span class="line"><span class="comment">* 	@a	乘数1</span></span><br><span class="line"><span class="comment">*   @b  乘数2</span></span><br><span class="line"><span class="comment">* Return:</span></span><br><span class="line"><span class="comment">*   返回相乘后的BigNum</span></span><br><span class="line"><span class="comment">**********************************************************/</span></span><br><span class="line"><span class="function">BigNum <span class="title">multi_2</span><span class="params">(BigNum a, BigNum b)</span></span>&#123;</span><br><span class="line">    BigNum c;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">2</span>;	<span class="comment">// 计算当前大数长度</span></span><br><span class="line">    <span class="keyword">if</span>(a.len &gt; <span class="number">2</span> || b.len &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        n = <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">while</span>(n &lt; a.len || n &lt; b.len)	<span class="comment">// n一直乘二直到n大于两数中较长者的长度</span></span><br><span class="line">            n &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 在大数前方补零直至两者长度都为n</span></span><br><span class="line">        a = addBeforeZero(a, n - a.len);</span><br><span class="line">        b = addBeforeZero(b, n - b.len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 长度为一则证明当前n依旧为2 将两数长度补至二</span></span><br><span class="line">    <span class="keyword">if</span>(a.len == <span class="number">1</span>)  a = addBeforeZero(a, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(b.len == <span class="number">1</span>)  b = addBeforeZero(b, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(n == <span class="number">2</span>)&#123;	<span class="comment">// 当前长度为2</span></span><br><span class="line">        <span class="keyword">int</span> inta = <span class="number">0</span>, intb = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = a.len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;	<span class="comment">// 用inta记录第一个数</span></span><br><span class="line">            inta += a.num[i];</span><br><span class="line">            <span class="keyword">if</span>(i != <span class="number">0</span>)&#123;</span><br><span class="line">                inta *= <span class="number">10</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = b.len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;	<span class="comment">// 用intb记录第二个数</span></span><br><span class="line">            intb += b.num[i];</span><br><span class="line">            <span class="keyword">if</span>(i != <span class="number">0</span>)&#123;</span><br><span class="line">                intb *= <span class="number">10</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> inttmp = inta * intb;	<span class="comment">// 两数相乘</span></span><br><span class="line">        <span class="built_in">string</span> tmp;	<span class="comment">// 将整数转为字符串 当然如果环境支持c11以上也可以直接使用std::itos</span></span><br><span class="line">        <span class="built_in">stringstream</span> sst;</span><br><span class="line">        sst &lt;&lt; inttmp;</span><br><span class="line">        sst &gt;&gt; tmp;</span><br><span class="line">        c = change(tmp);	<span class="comment">// 将当前两数乘积转为大数c</span></span><br><span class="line">        <span class="keyword">return</span> c;	<span class="comment">// 返回大数c</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        BigNum a0, a1, b0, b1, c0, c1, c2;</span><br><span class="line">        a1 = subBigNum(a, <span class="number">1</span>, (n/<span class="number">2</span>));<span class="comment">// a1为大数a的后半部分（我上方大数类中为了方便运算逆序存储）</span></span><br><span class="line">        a0 = subBigNum(a, (n/<span class="number">2</span>+<span class="number">1</span>), a.len - (n/<span class="number">2</span>) );	<span class="comment">// a0为大数a的前半部分</span></span><br><span class="line">        <span class="comment">// b0 b1同理</span></span><br><span class="line">        b1 = subBigNum(b, <span class="number">1</span>, (n/<span class="number">2</span>));</span><br><span class="line">        b0 = subBigNum(b, (n/<span class="number">2</span>+<span class="number">1</span>), b.len - (n/<span class="number">2</span>));</span><br><span class="line">        c2 = multi_2(a1, b1);</span><br><span class="line">        c0 = multi_2(a0, b0);</span><br><span class="line">        c1 = sub(multi_2(add(a0,a1),add(b0,b1)),add(c2, c0));</span><br><span class="line">        c2 = addAfterZero(c2, n);</span><br><span class="line">        c1 = addAfterZero(c1, n / <span class="number">2</span>);</span><br><span class="line">        c = add(add(c2, c1), c0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    BigNum num1,num2,c,e;</span><br><span class="line">    <span class="built_in">string</span> temp;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; temp;</span><br><span class="line">    num1 = change(temp);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; temp;</span><br><span class="line">    num2 = change(temp);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"num1: "</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = num1.len<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; num1.num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"num2: "</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = num2.len<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; num2.num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"比较大小"</span>;</span><br><span class="line">    <span class="keyword">if</span>(compare(num1, num2) == <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"&gt;"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(compare(num1, num2) == <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"&lt;"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"="</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"乘积"</span>;</span><br><span class="line">    BigNum num3 = multi_2(num1, num2);</span><br><span class="line">    rmZero(num3);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = num3.len<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; num3.num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"加和"</span> ;</span><br><span class="line">    c = add(num1, num2);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = c.len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">         <span class="built_in">cout</span> &lt;&lt; c.num[i];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"相减"</span> ;</span><br><span class="line">    c = sub(num1, num2);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = c.len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">         <span class="built_in">cout</span> &lt;&lt; c.num[i];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入int值计算与int的乘积（默认使用num1）"</span>;</span><br><span class="line">    <span class="keyword">int</span> mul;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; mul;</span><br><span class="line">    c = multi(num1, mul);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = c.len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; c.num[i];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入int值计算与int的商与余数（默认使用num1）"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; mul;</span><br><span class="line">    c = divide(num1, mul, r);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"商："</span>;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> i = c.len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; c.num[i];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">" 余数"</span> &lt;&lt; r &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/06/%E7%9F%A9%E9%98%B5%E8%BF%9E%E4%B9%98%E9%97%AE%E9%A2%98-DP-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/06/%E7%9F%A9%E9%98%B5%E8%BF%9E%E4%B9%98%E9%97%AE%E9%A2%98-DP-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">矩阵连乘问题(DP)原理分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-06 22:08:46" itemprop="dateCreated datePublished" datetime="2019-11-06T22:08:46+08:00">2019-11-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">算法相关</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="矩阵连乘问题（DP）原理分析"><a href="#矩阵连乘问题（DP）原理分析" class="headerlink" title="矩阵连乘问题（DP）原理分析"></a>矩阵连乘问题（DP）原理分析</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>给定n个可乘的数字矩阵 $A<em>1, A_2,…, A_n $，矩阵 $A_i $ 的规模为 $p</em>{i-1}\times p_i $ 求给定矩阵连乘的最优计算次序，使得计算乘积 $A_1\times A_2 \times … \times A_n $ 所需执行的数乘次数最少.</p>
<h2 id="矩阵乘法规则"><a href="#矩阵乘法规则" class="headerlink" title="矩阵乘法规则"></a>矩阵乘法规则</h2><p>$C=A\times B$ ，如果A为p行r列的矩阵，B为r行q列的矩阵，则根据矩阵乘法规则，A与B相乘后得到的矩阵C将是p行q列的矩阵，对于结果矩阵C中任意元素 $C<em>{ij}: C</em>{ij}= \sum {r \atop k=1} a<em>{ik}b</em>{kj}$ 即：一个元素 $C_{ij}$ 需要做r次乘法，所以若想要获得C中所有元素则需要进行 $p \times q \times r$次乘法。</p>
<p>由于矩阵乘法满足乘法结合律，所以当n个数字矩阵连乘时可以任意更换计算次序，随着计算次序的改变，所需计算的总乘法次数也会跟着改变，具体情况看下图。</p>
<p><img src="/2019/11/06/%E7%9F%A9%E9%98%B5%E8%BF%9E%E4%B9%98%E9%97%AE%E9%A2%98-DP-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/计算次序1.png" alt="img"></p>
<p><img src="/2019/11/06/%E7%9F%A9%E9%98%B5%E8%BF%9E%E4%B9%98%E9%97%AE%E9%A2%98-DP-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/计算次序2.png" alt="img"></p>
<p>现在要做的便是设计一种算法，可以求得一种计算次序使得总乘法次数最小。</p>
<h2 id="解法分析"><a href="#解法分析" class="headerlink" title="解法分析"></a>解法分析</h2><p>假设 $A_1\times A_2 \times … \times A_n$ 的最优计算次序会在$A_k$时断开（只是打个比方，就像上方图计算 $A_1 \times A_2 \times A_3 \times A_4$ 时在 $A_1$ 处断开成为 $A_1与A_2 \times (A_3\times A_4)$ 一样）这时对最优计算次序的计算也会断开成为两个子问题 </p>
<script type="math/tex; mode=display">
\left\{ \begin{aligned} 子问题1 & = & 求A_1\times A_2 \times ... \times A_k 的最优计算次序\\ 子问题2 & = & 求A_{k+1}\times A_{k+2} \times ... \times A_n 的最优计算次序\end{aligned} \right.</script><p>因为原问题是两子问题相乘，所以原问题的答案便是俩个子问题的答案加上最后一次两子问题产生的矩阵相乘所需要的乘法次数。根据上方列出的矩阵乘法计算规则 </p>
<script type="math/tex; mode=display">
最后一次需要乘法次数= \\ 子问题1矩阵的行数 \\ \times 子问题2矩阵的列数 \\ \times 计算结果矩阵中一个元素所需的乘法次数</script><p>而</p>
<script type="math/tex; mode=display">
计算结果矩阵中一个元素所需的乘法次数=子问题1矩阵的列数=子问题2矩阵的行数</script><p>这里我们把 $m[i][j]$ 记为最优计算次序下计算 $A<em>i \times A</em>{i+1} \times … \times A_j$ 所需的乘法次数（最少乘法次数）</p>
<p>根据上述假设，我们依旧假设 $A<em>i \times A</em>{i+1} \times … \times A_j$ 的最优计算次序会在 $A_k$ 时断开，这时的两个子问题便是 </p>
<script type="math/tex; mode=display">\left\{ \begin{aligned} 子问题1 & = & 求A_i\times A_{i+1} \times ... \times A_k 的最优计算次序m[i][k]\\ 子问题2 & = & 求A_{k+1}\times A_{k+2} \times ... \times A_j 的最优计算次序m[k+1][j]\end{aligned} \right.</script><p>根据上次假设总结出的公式我们便可以得到 </p>
<script type="math/tex; mode=display">m[i][j]=m[i][k]+m[k+1][j]+最后一次需要乘法次数(子问题1矩阵\times 子问题2矩阵)</script><p>由于在矩阵连乘中，前一个矩阵的列数与后一个矩阵的行数相同，所以这里我们把所有矩阵的行与列属性记录在一个一维数组p中 $P<em>0$ 表示第一个矩阵的行数 $p_1$ 表示第一个矩阵的列数与第二个矩阵的行数，以此类推 $p</em>{n-1}$ 代表第n-1个矩阵的列数与第n个矩阵的行​数。</p>
<script type="math/tex; mode=display">
最后一次所需乘法= \\ 子问题1矩阵的行数（等于A_i的行数） \\ \times 子问题2矩阵的列数（等于A_j的列数） \\ \times 计算结果矩阵中一个元素所需的乘法次数（等于子问题2矩阵的行数等于A_k的列数）\\=p_{i-1} \times p_j \times p_k</script><p>这样便得到了动态规划算法最核心的动态转移方程</p>
<script type="math/tex; mode=display">
m[i][j]=\left\{ \begin{aligned} 0(i = j )\\ m[i][k]+m[k+1][j]+p_{i-1} \times p_j \times p_k(i < j)\end{aligned} \right.</script><p>有了它便可以去写代码了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">Dijkstra原理分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-05 22:01:55" itemprop="dateCreated datePublished" datetime="2019-11-05T22:01:55+08:00">2019-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">算法相关</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Dijkstra（迪杰斯特拉）"><a href="#Dijkstra（迪杰斯特拉）" class="headerlink" title="Dijkstra（迪杰斯特拉）"></a>Dijkstra（迪杰斯特拉）</h2><p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-1.svg" alt="img"></p>
<p>假设给定的源点是A，现在要求的便是源点A到其他所有点的最短路长度</p>
<p>我们初始将所有点看作不连通</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-2.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第一次优化"><a href="#第一次优化" class="headerlink" title="第一次优化"></a>第一次优化</h3><p>我们所规定的源点为A，A点到其本身的距离为0。这样我们就找到了第一个距离源点A最近的点，就是A本身，将其标记为红色。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-3.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>0</code></strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第二次优化"><a href="#第二次优化" class="headerlink" title="第二次优化"></a>第二次优化</h3><p>之后恢复以A为起点的所有边，更新所有可达点的最短路长度。如下图，可以发现以A为起点的两条边分别通向B与D，根据边权我们可以把B与D到A的最短路长度进行更新，可以发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A点到B点的最短路长度由无穷大优化为了2</span><br><span class="line">A点到D点的最短路长度由无穷大优化为了1</span><br></pre></td></tr></table></figure>
<p>这时观察所有的点，我们可以发现当前距离A点最近且还没有被标为红色的点便是我们刚刚更新的D。我们便可以确定，A点到D点的最短路径1，将D标记为红色。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-4.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td>2</td>
<td>∞</td>
<td><strong><code>1</code></strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第三次优化"><a href="#第三次优化" class="headerlink" title="第三次优化"></a>第三次优化</h3><p>重复之前操作，恢复以D为起点的所有边，以D为跳板更新所有未被标红的可达点的最短路长度，更新后可以发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A点到C点的最短路长度由无穷大被优化为了3</span><br><span class="line">A点到E点的最短路长度由无穷大被优化为了3</span><br><span class="line">A点到F点的最短路长度由无穷大被优化为了9</span><br><span class="line">A点到G点的最短路长度由无穷大被优化为了5</span><br></pre></td></tr></table></figure>
<p>这时观察所有的点，我们可以发现当前距离A点最近且还没有被标为红色的点是最短路长度为2的点B。我们便可以确定，A点到B点的最短路径2，将B标记为红色。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-5.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td><strong><code>2</code></strong></td>
<td>3</td>
<td><strong>1</strong></td>
<td>3</td>
<td>9</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第四次优化"><a href="#第四次优化" class="headerlink" title="第四次优化"></a>第四次优化</h3><p>重复之前操作，恢复以B为起点的所有边，以B为跳板更新所有未被标红的可达点的最短路长度，更新后可以发现没有点可以被更新。</p>
<p>这时观察所有的点，我们可以发现当前距离A点最近且还没有被标为红色的点有两个，分别为最短路长度为3的点C与最短路长度为3的点E。我们可以选任意一个将其标为红色（以已经固定长度的点去优化另一个点，被优化的点的长度一定不会小于优化它的点，所以在这里另一个点一定会在下次优化中被标红）这里我选择点C。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-6.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td><strong>2</strong></td>
<td><strong><code>3</code></strong></td>
<td><strong>1</strong></td>
<td>3</td>
<td>9</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第五次优化"><a href="#第五次优化" class="headerlink" title="第五次优化"></a>第五次优化</h3><p>重复之前操作，恢复以C为起点的所有边，以C为跳板更新所有未被标红的可达点的最短路长度，更新后可以发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A点到F点的最短路长度由无穷大被优化为了8</span><br></pre></td></tr></table></figure>
<p>这时观察所有的点，我们可以发现当前距离A点最近且还没有被标为红色的是上一次没有选择的最短路长度为3的点E。我们便可以确定，A点到E点的最短路径3，将E标记为红色。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-7.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td><strong>2</strong></td>
<td><strong>3</strong></td>
<td><strong>1</strong></td>
<td><strong><code>3</code></strong></td>
<td>8</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第六次优化"><a href="#第六次优化" class="headerlink" title="第六次优化"></a>第六次优化</h3><p>依旧是重复之前操作，恢复以E为起点的所有边，以E为跳板更新所有未被标红的可达点的最短路长度，更新后可以发现没有点可以被更新。</p>
<p>依旧是观察所有的点，我们可以发现当前距离A点最近且还没有被标为红色的是最短路长度为5的点G。我们便可以确定，A点到G点的最短路径5，将G标记为红色。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-8.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td><strong>2</strong></td>
<td><strong>3</strong></td>
<td><strong>1</strong></td>
<td><strong>3</strong></td>
<td>8</td>
<td><strong><code>5</code></strong></td>
</tr>
</tbody>
</table>
</div>
<h3 id="第七次优化"><a href="#第七次优化" class="headerlink" title="第七次优化"></a>第七次优化</h3><p>重复之前操作，恢复以G为起点的所有边，以G为跳板更新所有未被标红的可达点的最短路长度，更新后可以发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A点到F点的最短路长度由无穷大被优化为了6</span><br></pre></td></tr></table></figure>
<p>依旧是观察所有的点，我们可以发现当前距离A点最近且还没有被标为红色的是最短路长度为5的最后一个点F。我们便可以确定，A点到F点的最短路径6，将F标记为红色，至此所有的点都优化完毕。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra1-9.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td><strong>2</strong></td>
<td><strong>3</strong></td>
<td><strong>1</strong></td>
<td><strong>3</strong></td>
<td><strong><code>6</code></strong></td>
<td><strong>5</strong></td>
</tr>
</tbody>
</table>
</div>
<h3 id="最短路长度表汇总"><a href="#最短路长度表汇总" class="headerlink" title="最短路长度表汇总"></a>最短路长度表汇总</h3><div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr>
</thead>
<tbody>
<tr>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong><code>0</code></strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>0</strong></td>
<td>2</td>
<td>∞</td>
<td><strong><code>1</code></strong></td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>0</strong></td>
<td><strong><code>2</code></strong></td>
<td>3</td>
<td><strong>1</strong></td>
<td>3</td>
<td>9</td>
<td>5</td>
</tr>
<tr>
<td><strong>0</strong></td>
<td><strong>2</strong></td>
<td><strong><code>3</code></strong></td>
<td><strong>1</strong></td>
<td>3</td>
<td>9</td>
<td>5</td>
</tr>
<tr>
<td><strong>0</strong></td>
<td><strong>2</strong></td>
<td><strong>3</strong></td>
<td><strong>1</strong></td>
<td><strong><code>3</code></strong></td>
<td>8</td>
<td>5</td>
</tr>
<tr>
<td><strong>0</strong></td>
<td><strong>2</strong></td>
<td><strong>3</strong></td>
<td><strong>1</strong></td>
<td><strong>3</strong></td>
<td>8</td>
<td><strong><code>5</code></strong></td>
</tr>
<tr>
<td><strong>0</strong></td>
<td><strong>2</strong></td>
<td><strong>3</strong></td>
<td><strong>1</strong></td>
<td><strong>3</strong></td>
<td><strong><code>6</code></strong></td>
<td><strong>5</strong></td>
</tr>
</tbody>
</table>
</div>
<h3 id="不适用情况"><a href="#不适用情况" class="headerlink" title="不适用情况"></a>不适用情况</h3><p>只要图中有任何负权边，dijkstra边不能正确得到预期答案，即使没有负环也不行。</p>
<p>至于为什么，可以从如下图的例子中看出</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra2-1.svg" alt="img"></p>
<p>按照之前的方法进行分析</p>
<p>我们初始将所有点看作不连通</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra2-2.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>∞</td>
<td>∞</td>
<td>∞</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第一次优化-1"><a href="#第一次优化-1" class="headerlink" title="第一次优化"></a>第一次优化</h4><p>A点到其本身的距离为0。找到了第一个距离源点A最近的点，为A本身，将其标记为红色。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra2-3.svg" alt="img"></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>0</code></strong></td>
<td>∞</td>
<td>∞</td>
</tr>
</tbody>
</table>
</div>
<h4 id="第二次优化-1"><a href="#第二次优化-1" class="headerlink" title="第二次优化"></a>第二次优化</h4><p>恢复以A为起点的所有边，更新所有可达点的最短路长度。</p>
<p>如下图</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra2-4.svg" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A点到B点的最短路长度由无穷大优化为了3</span><br><span class="line">A点到C点的最短路长度由无穷大优化为了2</span><br></pre></td></tr></table></figure>
<p>当前距离A点最近且还没有被标为红色的点是C，A点到C点的最短路径2，将C标记为红色。</p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td>3</td>
<td><strong><code>2</code></strong></td>
</tr>
</tbody>
</table>
</div>
<h4 id="第三次优化-1"><a href="#第三次优化-1" class="headerlink" title="第三次优化"></a>第三次优化</h4><p>恢复以C为起点的所有边，更新所有可达点的最短路长度。</p>
<p>如下图</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra2-5.svg" alt="img"></p>
<p>没有点可以被更新</p>
<p>当前距离A点最近且还没有被标为红色的点是B，A点到B点的最短路径3，将B标记为红色。</p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td><strong><code>3</code></strong></td>
<td><strong>2</strong></td>
</tr>
</tbody>
</table>
</div>
<h4 id="第四次优化-1"><a href="#第四次优化-1" class="headerlink" title="第四次优化"></a>第四次优化</h4><p>恢复以B为起点的所有边，更新所有可达点的最短路长度。</p>
<p>如下图</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra2-6.svg" alt="img"></p>
<p><strong>由于C已经被固定，所以没有点可以被更新！！</strong></p>
<p>当前A点到所有点的最短路长度表</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td><strong>3</strong></td>
<td><strong>2</strong></td>
</tr>
</tbody>
</table>
</div>
<p>所以上表便是dijkstra得出的最终结果，而并不是我们认为的</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td><strong>3</strong></td>
<td><strong>1</strong></td>
</tr>
</tbody>
</table>
</div>
<h3 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h3><h4 id="一般实现"><a href="#一般实现" class="headerlink" title="一般实现"></a>一般实现</h4><p>以上方正确示例为例，为了方便处理，我们将A~G这七个字母在算法中以0~6七个点所代替。</p>
<p>我们可以得出下图的输入数据</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra3-1.svg" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">7 12</span><br><span class="line">0 1 2</span><br><span class="line">0 3 1</span><br><span class="line">1 3 3</span><br><span class="line">1 4 10</span><br><span class="line">2 0 4</span><br><span class="line">2 5 5</span><br><span class="line">3 2 2</span><br><span class="line">3 4 2</span><br><span class="line">3 5 8</span><br><span class="line">3 6 4</span><br><span class="line">4 6 6</span><br><span class="line">6 5 1</span><br></pre></td></tr></table></figure>
<p>代码实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">1e3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">1e6</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, dis;</span><br><span class="line">    Node(<span class="keyword">int</span> tv, <span class="keyword">int</span> tdis)&#123;</span><br><span class="line">        v = tv, dis = tdis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n;  <span class="comment">//n为顶点数量</span></span><br><span class="line"><span class="keyword">int</span> d[MAXV]; <span class="comment">//存放起点到各点的最短路径长度</span></span><br><span class="line"><span class="built_in">vector</span>&lt;Node&gt; Adj[MAXV];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXV]; <span class="comment">//标记数组</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    fill(d, d + MAXV, inf); <span class="comment">//初始化起点到所有点的最短路长度为无穷大</span></span><br><span class="line">    d[s] = <span class="number">0</span>;   <span class="comment">//起点至本身的距离为0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        <span class="keyword">int</span> u = <span class="number">-1</span>, mind = inf;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)&#123; <span class="comment">//寻找距离顶点最近的点</span></span><br><span class="line">            <span class="keyword">if</span>(!vis[j] &amp;&amp; d[j] &lt; mind)&#123;</span><br><span class="line">                u = j;</span><br><span class="line">                mind = d[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(u == <span class="number">-1</span>) <span class="comment">//若找不到u证明剩下的点与顶点不连通</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        vis[u] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> j : Adj[u])&#123;   <span class="comment">//遍历所有与u连通的点</span></span><br><span class="line">            <span class="keyword">int</span> v = j.v;</span><br><span class="line">            <span class="keyword">if</span>(!vis[v] &amp;&amp; d[u] + j.dis &lt; d[v])&#123; <span class="comment">//以u为中转优化起点到与u连通的点的最短距离</span></span><br><span class="line">                d[v] = d[u] + j.dis;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">int</span> s;  <span class="comment">//为起点</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt;<span class="string">"输入顶点数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">int</span> r;<span class="comment">//路径数</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入路径数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r; i++)&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入路径（格式:端点1 端点2 权值）:"</span>;</span><br><span class="line">        <span class="keyword">int</span> u, v, dis;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; dis;</span><br><span class="line">        Adj[u].push_back(Node(v, dis));</span><br><span class="line">        <span class="comment">//Adj[v].push_back(Node(u, dis));</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入起点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    dijkstra(s);</span><br><span class="line">    <span class="keyword">int</span> e;  <span class="comment">//终点</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入终点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; e;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"最短路长度"</span> &lt;&lt; d[e] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++)&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">":"</span> &lt;&lt; d[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="堆优化dijkstra"><a href="#堆优化dijkstra" class="headerlink" title="堆优化dijkstra"></a>堆优化dijkstra</h4><p>分析一下上方dijkstra的时间复杂度，设顶点个数n，外层循环为 $ O(n) $，内层循环有寻找距离起点最近的点需要 $ O(n) $，每次枚举被优化点v需要$O(Adj[u].size) $总共需要 $ O(\sum {n-1 \atop u=0} Adj[u].size)=E $，总时间复杂度 $ O(N\times N + E)=O(N^2+E) $</p>
<p>如何去优化它呢？压榨外层循环，根据dijkstra的原理显然是不太现实的，但是根据前的设计dijkstra在每次进行优化时都需要寻找距离起点最近的点，这需要每次都遍历所有的点，这里便可以使用堆优化来降低时间复杂度，可以直接使用STL里的优先队列priority_queue，使距离起点进的点优先出队，这样就可以将内层循环中寻找距离起点最近的点消耗的 $ O(N) $优化为维护优先队列的 $ O(logN) $，这样总时间复杂度就降为了 $ O(NlogN+E) $</p>
<p>代码实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e6</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> d[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, dis;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> node &amp;tNode) <span class="keyword">const</span>&#123;  <span class="comment">//优先队列默认优先级高的先出队 这里就要通过重载运算符 &lt; 使距离越小优先级越高</span></span><br><span class="line">        <span class="keyword">return</span> dis &gt; tNode.dis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;node&gt; Adj[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    fill(d, d + MAXN, INF); <span class="comment">//初始化起点至所有点距离为无穷大</span></span><br><span class="line">    priority_queue&lt;node&gt; Q;</span><br><span class="line">    d[s] = <span class="number">0</span>;   <span class="comment">//起点至其本身距离为0</span></span><br><span class="line">    Q.push(node&#123;s, <span class="number">0</span>&#125;); <span class="comment">//这里node中v代表的是当前顶点，dis代表其与起点的距离</span></span><br><span class="line">    <span class="keyword">while</span>(!Q.empty())&#123;</span><br><span class="line">        node f = Q.top();</span><br><span class="line">        Q.pop();</span><br><span class="line">        <span class="keyword">int</span> u = f.v;</span><br><span class="line">        <span class="keyword">if</span>(vis[u])  <span class="comment">//如果u已经标记则继续出队</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        vis[u] = <span class="literal">true</span>;  <span class="comment">//将u标记</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : Adj[u])&#123;   <span class="comment">//遍历所有与u相邻的顶点</span></span><br><span class="line">            <span class="keyword">int</span> v = i.v;</span><br><span class="line">            <span class="keyword">int</span> dis = i.dis;</span><br><span class="line">            <span class="keyword">if</span>(!vis[v] &amp;&amp; d[u] + dis &lt; d[v])&#123;   <span class="comment">//如果可以以u为中转优化起点到对应点的距离</span></span><br><span class="line">                d[v] = d[u] + dis;      <span class="comment">//执行松弛操作</span></span><br><span class="line">                Q.push(node&#123;v, d[v]&#125;);   <span class="comment">//将松弛后的点与距离入队</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入顶点数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边数"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i ++)&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边 (端点1 端点2 权值):"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">int</span> u, v, dis;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; dis;</span><br><span class="line">        Adj[u].push_back(node&#123;v, dis&#125;);</span><br><span class="line">        <span class="comment">//Adj[v].push_back(node&#123;u, dis&#125;);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> s;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入起点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="keyword">int</span> e;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入终点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; e;</span><br><span class="line">    dijkstra(s);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"最短路长度:"</span> &lt;&lt; d[e] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" : "</span> &lt;&lt; d[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Dijkstra记录最短路路径"><a href="#Dijkstra记录最短路路径" class="headerlink" title="Dijkstra记录最短路路径"></a>Dijkstra记录最短路路径</h4><p>记录最短路径的方法非常简单，这里只需要开一个长度为n的数组pre，在每次进行优化的时候，记录每个被优化点的前驱点，最后由终点开始寻找前驱直到找到起点即可获得最短路径。</p>
<p>代码实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e7</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, dis;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp;tNode) <span class="keyword">const</span>&#123;  <span class="comment">// 优先队列默认优先级高的先出队 这里就要通过重载运算符 &lt; 使距离越小优先级越高</span></span><br><span class="line">        <span class="keyword">return</span> dis &gt; tNode.dis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;Node&gt; Adj[MAXN];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="keyword">int</span> d[MAXN], pre[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    fill(d, d +MAXN, INF);  <span class="comment">// 初始化起点至所有点距离为无穷大</span></span><br><span class="line">    d[s] = <span class="number">0</span>;    <span class="comment">// 起点至其本身距离为0</span></span><br><span class="line">    priority_queue&lt;Node&gt; Q; <span class="comment">// 这里node中v代表的是当前顶点，dis代表其与起点的距离</span></span><br><span class="line">    Q.push(Node&#123;s, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!Q.empty())&#123;</span><br><span class="line">        Node f = Q.top();</span><br><span class="line">        Q.pop();</span><br><span class="line">        <span class="keyword">int</span> u = f.v;</span><br><span class="line">        <span class="keyword">if</span>(vis[u])  <span class="comment">// 如果u已经标记则继续出队</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        vis[u] = <span class="literal">true</span>;  <span class="comment">// 将u标记</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : Adj[u])&#123;   <span class="comment">// 遍历所有与u相邻的顶点</span></span><br><span class="line">            <span class="keyword">if</span>(d[i.v] &gt; d[u] + i.dis)&#123;  <span class="comment">// 如果可以以u为中转优化起点到对应点的距离</span></span><br><span class="line">                d[i.v] = d[u] + i.dis;  <span class="comment">// 执行松弛操作</span></span><br><span class="line">                pre[i.v] = u;   <span class="comment">// 记录本次优化的前驱点</span></span><br><span class="line">                Q.push(Node&#123;i.v, d[i.v]&#125;);  <span class="comment">// 将松弛后的点与距离入队</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入顶点数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, dis;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边（顶点1 顶点2 权值）:"</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt;  u &gt;&gt; v &gt;&gt; dis;</span><br><span class="line">        Adj[u].push_back(Node&#123;v, dis&#125;);</span><br><span class="line">        Adj[v].push_back(Node&#123;u,dis&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> s, e;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入起点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入终点:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; e;</span><br><span class="line">    dijkstra(s);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"最短路长度:"</span> &lt;&lt; d[e] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">int</span> tmp = e;</span><br><span class="line">    <span class="keyword">while</span>(tmp != s)&#123;    <span class="comment">// 由重点开始寻找前驱便可以获得最短路径</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; tmp &lt;&lt; <span class="string">" &lt;- "</span>;</span><br><span class="line">        tmp = pre[tmp];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; s &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Dijkstra-DFS"><a href="#Dijkstra-DFS" class="headerlink" title="Dijkstra+DFS"></a>Dijkstra+DFS</h4><p>在考查dijkstra算法时又是可能会出现最短路不只存在一条的情况，这是通常就会给你一个其他的判断条件，比如要求找出点权和最大的最短路。</p>
<p><img src="/2019/11/05/Dijkstra%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/dijkstra3-2.svg" alt="img"></p>
<p>观察上图，以红色为起点，蓝色为终点，求一条途经点的点权和最高的最短路。</p>
<p>先不考虑点权，先来看对多条最短路的记录，之前在只记录一条最短路时采取了pre前驱数组的方式，单如果有多条最短路，便要使用其他方式。使用前驱数组时，每次只有在某个点被优化时才记录其前驱结点，对到起点距离相等的情况并没有进行处理，也就是说当存在多条最短路径时，即使某个点在被优化时产生了到起点距离相等的情况也要对其进行记录，每个点的前驱就可能不止一个。</p>
<p>这里便可以将int型数组pre更换为容器型（vector）数组，pre[i]中记录的是i点所有的前驱结点。</p>
<p>这样便成功记录了所有的最短路径。若想从这些最短路径中计算出一条点权和最大的来，就可以用dfs去搜索每一条最短路并记录点权和，最终选出点权和最大的最短路。</p>
<p>比如pat <a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805523835109376" target="_blank" rel="noopener">PAT (Advanced Level) Practice  <strong>1003</strong> <strong>Emergency</strong> </a>就是一道典型的这种类型的题目。</p>
<p>送上代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">510</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">500000</span>;</span><br><span class="line"><span class="keyword">int</span> d[MAXN];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, dis;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp;tNode) <span class="keyword">const</span>    <span class="comment">// 优先队列默认优先级高的先出队 这里就要通过重载运算符 &lt; 使距离越小优先级越高</span></span><br><span class="line">        <span class="keyword">return</span> dis &gt; tNode.dis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, s, e;</span><br><span class="line"><span class="keyword">int</span> val[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;Node&gt; Adj[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pre[MAXN];  <span class="comment">// 存储每个点的所有前驱点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    fill(d, d + MAXN, INF); <span class="comment">// 初始化起点至所有点距离为无穷大</span></span><br><span class="line">    d[s] = <span class="number">0</span>;   <span class="comment">// 起点至其本身距离为0</span></span><br><span class="line">    priority_queue&lt;Node&gt; Q;  <span class="comment">// 这里node中v代表的是当前顶点，dis代表其与起点的距离</span></span><br><span class="line">    Q.push(Node&#123;s, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!Q.empty())&#123;</span><br><span class="line">        Node f = Q.top();</span><br><span class="line">        Q.pop();</span><br><span class="line">        <span class="keyword">int</span> u = f.v;</span><br><span class="line">        <span class="keyword">if</span>(!vis[u])&#123;    <span class="comment">// 如果未经标记</span></span><br><span class="line">            vis[u] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> i : Adj[u])&#123;   <span class="comment">// 遍历所有与u相邻的顶点</span></span><br><span class="line">                <span class="keyword">if</span>(d[i.v] &gt; d[u] + i.dis)&#123;  <span class="comment">// 如果可以以u为中转优化起点到对应点的距离</span></span><br><span class="line">                    d[i.v] = d[u] + i.dis;  <span class="comment">// 执行松弛操作</span></span><br><span class="line">                    Q.push(Node&#123;i.v, d[i.v]&#125;);</span><br><span class="line">                    pre[i.v].clear();   <span class="comment">// 清除之前记录的前驱</span></span><br><span class="line">                    pre[i.v].push_back(u);  <span class="comment">// u记录为v的前驱</span></span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(d[i.v] == d[u] + i.dis)&#123;</span><br><span class="line">                    pre[i.v].push_back(u);  <span class="comment">// u添加为v的前驱</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; road;   <span class="comment">// 记录最终点权和最大的最短路</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; troad;  <span class="comment">// 记录遍历中的每一条最短路</span></span><br><span class="line"><span class="keyword">int</span> minRoadCnt;</span><br><span class="line"><span class="keyword">int</span> saveCnt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> ed)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ed == s)&#123;</span><br><span class="line">        minRoadCnt++;</span><br><span class="line">        <span class="keyword">int</span> tempSaveCnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : troad)&#123;</span><br><span class="line">            tempSaveCnt += val[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(saveCnt &lt; tempSaveCnt)&#123;</span><br><span class="line">            road = troad;</span><br><span class="line">            saveCnt = tempSaveCnt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : pre[ed])&#123;</span><br><span class="line">            troad.push_back(i);</span><br><span class="line">            dfs(i);</span><br><span class="line">            troad.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; e;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n ; i ++)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; val[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i ++)&#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, dis;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; dis;</span><br><span class="line">        Adj[u].push_back(Node&#123;v, dis&#125;);</span><br><span class="line">        Adj[v].push_back(Node&#123;u, dis&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    dijkstra(s);</span><br><span class="line">    troad.push_back(e);</span><br><span class="line">    dfs(e);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; minRoadCnt &lt;&lt; <span class="string">" "</span> &lt;&lt; saveCnt &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// 打印路径</span></span><br><span class="line">    <span class="comment">/*for(int i = road.size() - 1; i &gt;= 0; i--)&#123;</span></span><br><span class="line"><span class="comment">        if(i == road.size() - 1)</span></span><br><span class="line"><span class="comment">            cout &lt;&lt; road[i];</span></span><br><span class="line"><span class="comment">        else</span></span><br><span class="line"><span class="comment">            cout &lt;&lt; " " &lt;&lt; road[i];</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.suvvm.work/2019/11/02/PTA-Advanced-Level-1029-Median/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ortrait.jpg">
      <meta itemprop="name" content="SUVVM">
      <meta itemprop="description" content="SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SUVVM">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/02/PTA-Advanced-Level-1029-Median/" class="post-title-link" itemprop="url">PTA (Advanced Level) 1029 Median</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-02 00:11:27" itemprop="dateCreated datePublished" datetime="2019-11-02T00:11:27+08:00">2019-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-19 22:05:00" itemprop="dateModified" datetime="2020-12-19T22:05:00+08:00">2020-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">算法相关</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Given an increasing sequence S of N integers, the median is the number at the middle position. For example, the median of S1 = { 11, 12, 13, 14 } is 12, and the median of S2 = { 9, 10, 15, 16, 17 } is 15. The median of two sequences is defined to be the median of the nondecreasing sequence which contains all the elements of both sequences. For example, the median of S1 and S2 is 13.</p>
<p>Given two increasing sequences of integers, you are asked to find their median.</p>
<h3 id="Input-Specification"><a href="#Input-Specification" class="headerlink" title="Input Specification:"></a>Input Specification:</h3><p>Each input file contains one test case. Each case occupies 2 lines, each gives the information of a sequence. For each sequence, the first positive integer N (≤2×105) is the size of that sequence. Then N integers follow, separated by a space. It is guaranteed that all the integers are in the range of <strong>long int</strong>.</p>
<h3 id="Output-Specification"><a href="#Output-Specification" class="headerlink" title="Output Specification:"></a>Output Specification:</h3><p>For each test case you should output the median of the two given sequences in a line.</p>
<h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input:"></a>Sample Input:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4 11 12 13 14</span><br><span class="line">5 9 10 15 16 17</span><br></pre></td></tr></table></figure>
<h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output:"></a>Sample Output:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13</span><br></pre></td></tr></table></figure>
<p>解题思路：<br>　　本题没有任何难度，为何会分到25分，这谁也不知道，题意就是给予两行两个long int序列，每个序列第一位为序列长度，求两个序列合并后的中位数。</p>
<p>AC代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> val;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt; seq;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;val);</span><br><span class="line">        seq.push_back(val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;val);</span><br><span class="line">        seq.push_back(val);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(seq.begin(), seq.end());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, seq[(seq.size() <span class="number">-1</span>) / <span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SUVVM"
      src="/images/ortrait.jpg">
  <p class="site-author-name" itemprop="name">SUVVM</p>
  <div class="site-description" itemprop="description">SUVVM的个人博客，主要涉及编程知识分享、算法题解等方面</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">148</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">84</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/suvvm" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;suvvm" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/suvvm@foxmail.com" title="E-Mail → suvvm@foxmail.com"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SUVVM</span>
	<a href="http://www.beian.miit.gov.cn/"  style="color:#f72b07" target="_blank">鲁ICP备19040043号-2</a>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
